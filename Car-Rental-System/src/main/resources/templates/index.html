<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VeloRent - Car Rental Service</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css" />
    <!-- Custom CSS -->
    <style>
      :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --accent-color: #4cc9f0;
        --light-bg: #f8f9fa;
        --dark-bg: #212529;
        --text-light: #f8f9fa;
        --text-dark: #212529;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-bg);
      }

      .navbar {
        background-color: var(--primary-color);
      }

      .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
        color: white !important;
      }

      .nav-link {
        color: rgba(255, 255, 255, 0.85) !important;
        font-weight: 500;
      }

      .nav-link:hover {
        color: white !important;
      }

      .auth-buttons .btn {
        margin-left: 10px;
        border-radius: 20px;
        padding: 8px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-outline-light {
        border: 2px solid white;
      }

      .btn-outline-light:hover {
        background-color: white;
        color: var(--primary-color) !important;
      }

      .btn-light {
        background-color: white;
        color: var(--primary-color) !important;
        border: 2px solid white;
      }

      .btn-light:hover {
        background-color: rgba(255,255,255,0.9);
        color: var(--secondary-color) !important;
      }

      .hero-section {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80') no-repeat center center;
        background-size: cover;
        color: white;
        padding: 120px 0;
        text-align: center;
      }

      .hero-title {
        font-size: 3.5rem;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .hero-subtitle {
        font-size: 1.5rem;
        margin-bottom: 30px;
      }

      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        padding: 10px 25px;
        font-weight: 600;
      }

      .btn-primary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
      }

      .section-title {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 60px 0 30px;
        color: var(--dark-bg);
      }

      .vehicle-card {
        border: none;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        margin-bottom: 25px;
      }

      .vehicle-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      }

      .vehicle-img {
        height: 200px;
        object-fit: cover;
      }

      .vehicle-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .vehicle-status {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #29cc97;
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .filter-section {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .filter-title {
        font-weight: bold;
        color: var(--dark-bg);
        margin-bottom: 15px;
      }

      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
      }

      .footer {
        background-color: var(--dark-bg);
        color: var(--text-light);
        padding: 50px 0 20px;
        margin-top: 60px;
      }

      .footer-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .footer-links a {
        color: #adb5bd;
        display: block;
        margin-bottom: 10px;
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .footer-links a:hover {
        color: white;
      }

      .social-icons a {
        color: white;
        font-size: 1.5rem;
        margin-right: 15px;
      }

      /* Packages Slideshow Styles */
      .packages-slider-container {
        position: relative;
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .packages-slider {
        display: flex;
        transition: transform 0.5s ease-in-out;
        will-change: transform;
      }

      .package-slide {
        min-width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
      }

      .package-slide::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.2);
        z-index: 1;
      }

      .package-content {
        flex: 1;
        z-index: 2;
        position: relative;
      }

      .package-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .package-description {
        font-size: 1.2rem;
        margin-bottom: 20px;
        opacity: 0.9;
      }

      .package-details {
        display: flex;
        gap: 30px;
        margin-bottom: 30px;
      }

      .package-detail-item {
        text-align: center;
      }

      .package-detail-value {
        font-size: 1.8rem;
        font-weight: bold;
        display: block;
      }

      .package-detail-label {
        font-size: 0.9rem;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .package-price {
        font-size: 3rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
      }

      .package-rent-btn {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        border: none;
        padding: 15px 35px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }

      .package-rent-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        background: linear-gradient(45deg, #ee5a24, #ff6b6b);
      }

      .package-rent-btn:active {
        transform: translateY(0);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }

      .package-rent-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
      }

      .package-rent-btn:hover::before {
        left: 100%;
      }

      .package-image {
        flex: 0 0 300px;
        z-index: 2;
        position: relative;
      }

      .package-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .slider-controls {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 3;
      }

      .slider-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .slider-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.1);
      }

      .slider-dots {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }

      .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .dot.active {
        background: var(--primary-color);
        transform: scale(1.2);
      }

      @media (max-width: 768px) {
        .package-slide {
          flex-direction: column;
          text-align: center;
          padding: 40px 20px;
        }

        .package-image {
          flex: none;
          margin-top: 30px;
        }

        .package-title {
          font-size: 2rem;
        }

        .package-price {
          font-size: 2.5rem;
        }

        .package-details {
          justify-content: center;
        }
      }

      /* Customer Feedback Section Styles */
      .feedback-section {
        position: relative;
        overflow: hidden;
      }

      .feedback-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="%23000" opacity="0.05"/><circle cx="75" cy="75" r="1" fill="%23000" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
        opacity: 0.3;
        z-index: 1;
      }

      .feedback-section .container {
        position: relative;
        z-index: 2;
      }

      .feedback-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 1px solid rgba(0, 0, 0, 0.08);
        position: relative;
        overflow: hidden;
      }

      .feedback-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      }

      .feedback-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      .feedback-rating {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .feedback-rating .stars {
        display: flex;
        margin-right: 10px;
      }

      .feedback-rating .star {
        color: #ffd700;
        font-size: 1.2rem;
        margin-right: 2px;
      }

      .feedback-rating .star.empty {
        color: #ddd;
      }

      .feedback-rating .rating-text {
        color: #666;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .feedback-comment {
        font-style: italic;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #444;
        margin-bottom: 20px;
        position: relative;
      }

      .feedback-comment::before {
        content: '"';
        font-size: 3rem;
        color: var(--primary-color);
        position: absolute;
        top: -10px;
        left: -10px;
        opacity: 0.3;
        font-family: Georgia, serif;
      }

      .feedback-comment::after {
        content: '"';
        font-size: 3rem;
        color: var(--primary-color);
        position: absolute;
        bottom: -40px;
        right: 10px;
        opacity: 0.3;
        font-family: Georgia, serif;
      }

      .feedback-customer {
        display: flex;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid #eee;
      }

      .feedback-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .feedback-customer-info h6 {
        margin: 0;
        color: #333;
        font-weight: 600;
      }

      .feedback-customer-info small {
        color: #666;
        font-size: 0.85rem;
      }

      .feedback-loading {
        padding: 40px;
        text-align: center;
        color: #666;
        font-size: 1.1rem;
      }

      .feedback-loading i {
        margin-right: 10px;
        color: var(--primary-color);
      }

      .feedback-error {
        padding: 40px;
        text-align: center;
        color: #dc3545;
        font-size: 1.1rem;
      }

      .feedback-empty {
        padding: 40px;
        text-align: center;
        color: #666;
        font-size: 1.1rem;
      }

      @media (max-width: 768px) {
        .feedback-card {
          padding: 20px;
          margin-bottom: 20px;
        }

        .feedback-comment {
          font-size: 1rem;
        }

        .feedback-avatar {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-car-side mr-2"></i> VeloRent
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#vehicles">Vehicles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/feedback">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
          <div class="auth-buttons">
            <a href="/login" class="btn btn-outline-light">Login</a>
            <a href="/register" class="btn btn-light">Register</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <h1 class="hero-title">Find Your Perfect Ride</h1>
        <p class="hero-subtitle">Explore our fleet of premium vehicles for your next adventure</p>
        <a href="#vehicles" class="btn btn-primary btn-lg">
          <i class="fas fa-search mr-2"></i> Browse Vehicles
        </a>
      </div>
    </section>

    <!-- Packages Slideshow Section -->
    <section id="packages-slideshow" class="py-5" style="background-color: #f8f9fa;">
      <div class="container">
        <h2 class="section-title">Featured Rental Packages</h2>
        <div class="packages-slider-container">
          <div class="packages-slider" id="packages-slider">
            <!-- Package slides will be dynamically inserted here -->
          </div>
          <div class="slider-controls">
            <button class="slider-btn prev-btn" id="prev-btn">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="slider-btn next-btn" id="next-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="slider-dots" id="slider-dots">
            <!-- Dots will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Filter Section -->
    <div class="container mt-5">
      <div class="filter-section">
        <div class="row">
          <div class="col-md-3">
            <div class="form-group">
              <label class="filter-title">Make</label>
              <select class="form-control" id="make-filter">
                <option value="">All Makes</option>
                <!-- Will be populated dynamically -->
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label class="filter-title">Model</label>
              <select class="form-control" id="model-filter">
                <option value="">All Models</option>
                <!-- Will be populated dynamically -->
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label class="filter-title">Year</label>
              <select class="form-control" id="year-filter">
                <option value="">All Years</option>
                <!-- Will be populated dynamically -->
              </select>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label class="filter-title">Price Range</label>
              <select class="form-control" id="price-filter">
                <option value="">Any Price</option>
                <option value="0-5000">Under Rs 5,000/day</option>
                <option value="5000-10000">Rs 5,000 - Rs 10,000/day</option>
                <option value="10000-20000">Rs 10,000 - Rs 20,000/day</option>
                <option value="20000+">Rs 20,000+/day</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vehicles Section -->
    <section id="vehicles">
      <div class="container">
        <h2 class="section-title">Available Vehicles</h2>

        <!-- Loading Spinner (shown initially) -->
        <div id="loading-spinner" class="loading-spinner">
          <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>

        <!-- Error Message (hidden initially) -->
        <div id="error-message" class="alert alert-danger text-center" style="display: none;">
          Unable to load vehicles. Please try again later.
        </div>

        <!-- Vehicles Grid -->
        <div class="row" id="vehicles-container">
          <!-- Vehicle cards will be dynamically inserted here -->
        </div>
      </div>
    </section>

    <!-- Customer Feedback Section -->
    <section class="feedback-section py-5" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="section-title" style="color: #333; margin-bottom: 20px;">What Our Customers Say</h2>
          <p class="section-subtitle" style="color: #666; font-size: 1.1rem;">Real experiences from our valued customers</p>
        </div>
        
        <div class="row" id="feedback-container">
          <!-- Feedback cards will be dynamically inserted here -->
          <div class="col-12 text-center">
            <div class="feedback-loading">
              <i class="fas fa-spinner fa-spin"></i> Loading feedback...
            </div>
          </div>
        </div>
        
        <div class="text-center mt-4">
          <a href="/feedback" class="btn btn-primary">View All Feedback</a>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4">
            <h5 class="footer-title">VeloRent</h5>
            <p>Your trusted partner for all your vehicle rental needs. Quality vehicles at affordable prices.</p>
            <div class="social-icons mt-3">
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <h5 class="footer-title">Quick Links</h5>
            <div class="footer-links">
              <a href="#">About Us</a>
              <a href="#">Services</a>
              <a href="#">Terms of Service</a>
              <a href="#">Privacy Policy</a>
            </div>
          </div>
          <div class="col-md-3 mb-4">
            <h5 class="footer-title">Support</h5>
            <div class="footer-links">
              <a href="#">FAQ</a>
              <a href="#">Help Center</a>
              <a href="#">Contact Us</a>
              <a href="#">Careers</a>
            </div>
          </div>
          <div class="col-md-2 mb-4">
            <h5 class="footer-title">Contact</h5>
            <address>
              <p><i class="fas fa-map-marker-alt mr-2"></i> No32 Main St Melsiripura</p>
              <p><i class="fas fa-phone mr-2"></i> (123) 456-7890</p>
              <p><i class="fas fa-envelope mr-2"></i> 2025_Y2_S1_KUR_02@gmail.com</p>
            </address>
          </div>
        </div>
        <hr class="mt-4 mb-4" style="background-color: #6c757d;">
        <p class="text-center">&copy; 2025 VeloRent. All rights reserved.</p>
      </div>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="/js/jQuery/jquery-3.7.1.min.js"></script>
    <script src="/css/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const vehiclesContainer = document.getElementById('vehicles-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        const makeFilter = document.getElementById('make-filter');
        const modelFilter = document.getElementById('model-filter');
        const yearFilter = document.getElementById('year-filter');
        const priceFilter = document.getElementById('price-filter');

        // Available makes, models and years for filtering
        let availableMakes = new Set();
        let availableModels = new Set();
        let availableYears = new Set();

        // Store all vehicles
        let allVehicles = [];

        // Fetch available vehicles
        fetch('/api/vehicles/available')
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to fetch vehicles');
            }
            return response.json();
          })
          .then(vehicles => {
            // Hide loading spinner
            loadingSpinner.style.display = 'none';

            // Store all vehicles
            allVehicles = vehicles;

            // Populate filters
            vehicles.forEach(vehicle => {
              availableMakes.add(vehicle.make);
              availableModels.add(vehicle.model);
              availableYears.add(vehicle.year);
            });

            // Populate make filter options
            Array.from(availableMakes).sort().forEach(make => {
              const option = document.createElement('option');
              option.value = make;
              option.textContent = make;
              makeFilter.appendChild(option);
            });

            // Populate model filter options
            Array.from(availableModels).sort().forEach(model => {
              const option = document.createElement('option');
              option.value = model;
              option.textContent = model;
              modelFilter.appendChild(option);
            });

            // Populate year filter options
            Array.from(availableYears).sort((a, b) => b - a).forEach(year => {
              const option = document.createElement('option');
              option.value = year;
              option.textContent = year;
              yearFilter.appendChild(option);
            });

            // Display vehicles
            displayVehicles(vehicles);

            // Add event listeners to filters
            makeFilter.addEventListener('change', applyFilters);
            modelFilter.addEventListener('change', applyFilters);
            yearFilter.addEventListener('change', applyFilters);
            priceFilter.addEventListener('change', applyFilters);
          })
          .catch(error => {
            console.error('Error:', error);
            loadingSpinner.style.display = 'none';
            errorMessage.style.display = 'block';
          });

        // Function to display vehicles
        function displayVehicles(vehicles) {
          // Clear container
          vehiclesContainer.innerHTML = '';

          if (vehicles.length === 0) {
            vehiclesContainer.innerHTML = '<div class="col-12 text-center"><p>No vehicles match your criteria. Please try different filters.</p></div>';
            return;
          }

          // Loop through vehicles and create cards
          vehicles.forEach(vehicle => {
            const vehicleCard = document.createElement('div');
            vehicleCard.className = 'col-md-4 mb-4';

            // Default image if none provided
            const imageUrl = vehicle.imageUrl || 'https://via.placeholder.com/300x200?text=Vehicle+Image';

            vehicleCard.innerHTML = `
              <div class="card vehicle-card">
                <div class="position-relative">
                  <img src="${imageUrl}" class="card-img-top vehicle-img" alt="${vehicle.make} ${vehicle.model}">
                  <span class="vehicle-status">${vehicle.status}</span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">${vehicle.year} ${vehicle.make} ${vehicle.model}</h5>
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="vehicle-price">Rs ${vehicle.rentalRatePerDay}/day</span>
                    <small class="text-muted">Reg: ${vehicle.registrationNumber}</small>
                  </div>
                  <hr>
                  <div class="d-flex justify-content-between">
                    <a href="/login" class="btn btn-primary">Rent Now</a>
                    <button class="btn btn-outline-secondary" onclick="showVehicleDetails(${vehicle.vehicleId})">
                      <i class="fas fa-info-circle"></i> Details
                    </button>
                  </div>
                </div>
              </div>
            `;

            vehiclesContainer.appendChild(vehicleCard);
          });
        }

        // Function to apply filters
        function applyFilters() {
          const selectedMake = makeFilter.value;
          const selectedModel = modelFilter.value;
          const selectedYear = yearFilter.value;
          const selectedPrice = priceFilter.value;

          // Filter vehicles based on selected criteria
          let filteredVehicles = allVehicles;

          if (selectedMake) {
            filteredVehicles = filteredVehicles.filter(vehicle => vehicle.make === selectedMake);
          }

          if (selectedModel) {
            filteredVehicles = filteredVehicles.filter(vehicle => vehicle.model === selectedModel);
          }

          if (selectedYear) {
            filteredVehicles = filteredVehicles.filter(vehicle => vehicle.year == selectedYear);
          }

          if (selectedPrice) {
            const [min, max] = selectedPrice.split('-');
            if (max === '+') {
              filteredVehicles = filteredVehicles.filter(vehicle => parseFloat(vehicle.rentalRatePerDay) >= parseFloat(min));
            } else if (max) {
              filteredVehicles = filteredVehicles.filter(vehicle =>
                parseFloat(vehicle.rentalRatePerDay) >= parseFloat(min) &&
                parseFloat(vehicle.rentalRatePerDay) <= parseFloat(max)
              );
            }
          }

          // Display filtered vehicles
          displayVehicles(filteredVehicles);
        }

        // Make function available globally
        window.showVehicleDetails = function(vehicleId) {
          // Redirect to login for now, can be enhanced to show modal with details
          window.location.href = `/login?vehicleId=${vehicleId}`;
        };

        // Packages Slideshow Functionality
        const packagesSlider = document.querySelector('.packages-slider');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');

        let currentSlide = 0;
        let slideInterval;
        let totalSlides = 0;

        // Packages data will be fetched from API
        let packagesData = [];

        // Fetch packages from API
        function fetchPackagesData() {
          fetch('/api/public/packages')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch packages');
              }
              return response.json();
            })
            .then(data => {
              packagesData = data.map(pkg => ({
                id: pkg.packageId,
                title: pkg.packageName,
                description: `${pkg.packageName} - Duration: ${pkg.duration} days`,
                duration: `${pkg.duration} Days`,
                mileage: pkg.vehicles && pkg.vehicles.length > 0 ? `${pkg.vehicles.length} Vehicle${pkg.vehicles.length > 1 ? 's' : ''}` : 'Multiple Vehicles',
                fuel: 'Full Tank',
                price: `Rs. ${pkg.price}`,
                image: pkg.imageUrl || '/images/default-package.jpg'
              }));
              
              if (packagesData.length > 0) {
                initializeSlideshow();
              } else {
                // Hide slideshow section if no packages available
                const slideshowSection = document.getElementById('packages-slideshow');
                if (slideshowSection) {
                  slideshowSection.style.display = 'none';
                }
              }
            })
            .catch(error => {
              console.error('Error fetching packages:', error);
              // Hide slideshow section on error
              const slideshowSection = document.getElementById('packages-slideshow');
              if (slideshowSection) {
                slideshowSection.style.display = 'none';
              }
            });
        }

        // Initialize slideshow with data
        function initializeSlideshow() {
          if (packagesSlider && packagesData.length > 0) {
            totalSlides = packagesData.length;
            
            // Clear existing slides
            packagesSlider.innerHTML = '';
            
            // Create slides from data
            packagesData.forEach((pkg, index) => {
              const slide = document.createElement('div');
              slide.className = 'package-slide';
              slide.innerHTML = `
                <div class="package-content">
                  <h2 class="package-title">${pkg.title}</h2>
                  <p class="package-description">${pkg.description}</p>
                  <div class="package-details">
                    <div class="package-detail-item">
                      <span class="package-detail-value">${pkg.duration}</span>
                      <span class="package-detail-label">Duration</span>
                    </div>
                    <div class="package-detail-item">
                      <span class="package-detail-value">${pkg.mileage}</span>
                      <span class="package-detail-label">Vehicles</span>
                    </div>
                    <div class="package-detail-item">
                      <span class="package-detail-value">${pkg.fuel}</span>
                      <span class="package-detail-label">Fuel</span>
                    </div>
                  </div>
                  <div class="package-price">${pkg.price}</div>
                  <button class="package-rent-btn" onclick="rentPackage(${pkg.id})" title="Click to login and book this package">
                    ðŸ”’ Rent Now
                  </button>
                </div>
                <div class="package-image">
                  <img src="${pkg.image}" alt="${pkg.title}" class="package-img" 
                       onerror="this.src='/images/default-package.jpg'">
                </div>
              `;
              packagesSlider.appendChild(slide);
            });

            // Create dots
            createDots();
            
            // Update dots
            updateDots();
            
            // Start auto-slide
            startAutoSlide();
          }
        }

        // Create dots based on number of packages
        function createDots() {
          const sliderDots = document.getElementById('slider-dots');
          if (sliderDots) {
            sliderDots.innerHTML = '';
            packagesData.forEach((_, index) => {
              const dot = document.createElement('span');
              dot.className = 'dot';
              dot.addEventListener('click', () => {
                stopAutoSlide();
                goToSlide(index);
                startAutoSlide();
              });
              sliderDots.appendChild(dot);
            });
          }
        }

        // Update slide position
        function updateSlidePosition() {
          if (packagesSlider) {
            packagesSlider.style.transform = `translateX(-${currentSlide * 100}%)`;
            updateDots();
          }
        }

        // Update dots
        function updateDots() {
          const dots = document.querySelectorAll('.dot');
          dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
          });
        }

        // Go to next slide
        function nextSlide() {
          currentSlide = (currentSlide + 1) % totalSlides;
          updateSlidePosition();
        }

        // Go to previous slide
        function prevSlide() {
          currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
          updateSlidePosition();
        }

        // Go to specific slide
        function goToSlide(slideIndex) {
          currentSlide = slideIndex;
          updateSlidePosition();
        }

        // Start auto-slide (every 5 seconds)
        function startAutoSlide() {
          slideInterval = setInterval(nextSlide, 5000);
        }

        // Stop auto-slide
        function stopAutoSlide() {
          clearInterval(slideInterval);
        }

        // Event listeners for navigation
        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
            stopAutoSlide();
            prevSlide();
            startAutoSlide();
          });
        }

        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
            stopAutoSlide();
            nextSlide();
            startAutoSlide();
          });
        }

        // Event listeners for dots are now handled in createDots function

        // Pause auto-slide on hover
        if (packagesSlider) {
          packagesSlider.addEventListener('mouseenter', stopAutoSlide);
          packagesSlider.addEventListener('mouseleave', startAutoSlide);
        }

        // Fetch packages and initialize slideshow
        fetchPackagesData();

        // Fetch and display customer feedback
        fetchCustomerFeedback();

        // Rent package function (requires login)
        window.rentPackage = function(packageId) {
          console.log('Rent package clicked for ID:', packageId);
          
          // Check if user is logged in by checking for token
          const token = localStorage.getItem('token');
          const userEmail = localStorage.getItem('userEmail');
          
          console.log('Token exists:', !!token);
          console.log('User email exists:', !!userEmail);
          
          if (!token || !userEmail) {
            // User is not logged in, redirect to login page with return URL
            const returnUrl = encodeURIComponent(`/dashboard?packageId=${packageId}`);
            const loginUrl = `/login?returnUrl=${returnUrl}&message=Please login to book this package`;
            console.log('Redirecting to login:', loginUrl);
            window.location.href = loginUrl;
          } else {
            // User is logged in, redirect to dashboard with package pre-selected
            const dashboardUrl = `/dashboard?packageId=${packageId}`;
            console.log('Redirecting to dashboard:', dashboardUrl);
            window.location.href = dashboardUrl;
          }
        };

        // Fetch customer feedback from API
        function fetchCustomerFeedback() {
          const feedbackContainer = document.getElementById('feedback-container');
          
          if (!feedbackContainer) return;

          fetch('/api/public/feedback?page=0&size=6')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch feedback');
              }
              return response.json();
            })
            .then(feedbacks => {
              if (feedbacks && feedbacks.length > 0) {
                displayFeedback(feedbacks);
              } else {
                feedbackContainer.innerHTML = `
                  <div class="col-12">
                    <div class="feedback-empty">
                      <i class="fas fa-comments"></i>
                      <p>No customer feedback available yet.</p>
                    </div>
                  </div>
                `;
              }
            })
            .catch(error => {
              console.error('Error fetching feedback:', error);
              feedbackContainer.innerHTML = `
                <div class="col-12">
                  <div class="feedback-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Unable to load customer feedback at this time.</p>
                  </div>
                </div>
              `;
            });
        }

        // Display feedback in cards
        function displayFeedback(feedbacks) {
          const feedbackContainer = document.getElementById('feedback-container');
          if (!feedbackContainer) return;

          feedbackContainer.innerHTML = '';

          feedbacks.forEach(feedback => {
            const feedbackCard = createFeedbackCard(feedback);
            feedbackContainer.appendChild(feedbackCard);
          });
        }

        // Create a feedback card element
        function createFeedbackCard(feedback) {
          const col = document.createElement('div');
          col.className = 'col-lg-4 col-md-6 mb-4';

          // Generate star rating
          const stars = generateStarRating(feedback.rating);
          
          // Get customer initials for avatar
          const initials = getCustomerInitials(feedback.customerName);
          
          // Format date
          const feedbackDate = formatFeedbackDate(feedback.feedbackDate);

          col.innerHTML = `
            <div class="feedback-card">
              <div class="feedback-rating">
                <div class="stars">${stars}</div>
                <span class="rating-text">${feedback.rating}/5</span>
              </div>
              <div class="feedback-comment">
                ${feedback.comments}
              </div>
              <div class="feedback-customer">
                <div class="feedback-avatar">${initials}</div>
                <div class="feedback-customer-info">
                  <h6>${feedback.customerName}</h6>
                  <small>${feedbackDate}</small>
                </div>
              </div>
            </div>
          `;

          return col;
        }

        // Generate star rating HTML
        function generateStarRating(rating) {
          let stars = '';
          for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
              stars += '<i class="fas fa-star star"></i>';
            } else {
              stars += '<i class="far fa-star star empty"></i>';
            }
          }
          return stars;
        }

        // Get customer initials for avatar
        function getCustomerInitials(name) {
          if (!name) return '?';
          const names = name.split(' ');
          if (names.length >= 2) {
            return (names[0].charAt(0) + names[1].charAt(0)).toUpperCase();
          }
          return name.charAt(0).toUpperCase();
        }

        // Format feedback date
        function formatFeedbackDate(dateString) {
          if (!dateString) return '';
          try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });
          } catch (e) {
            return dateString;
          }
        }
      });
    </script>
  </body>
</html>
