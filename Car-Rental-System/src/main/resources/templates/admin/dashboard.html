<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Car Rental System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #1a237e;
        --secondary-color: #3498db;
        --accent-color: #2ecc71;
        --danger-color: #e74c3c;
        --text-color: #333;
        --light-text: #666;
        --background-color: #f8f9fa;
        --card-background: #fff;
        --border-color: #e1e1e1;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Roboto", "Segoe UI", Arial, sans-serif;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background-color: var(--primary-color);
        color: white;
        padding: 1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .nav-links {
        display: flex;
        gap: 20px;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        padding: 8px 15px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      .nav-links a:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      main {
        margin-top: 30px;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .dashboard-title {
        font-size: 24px;
        color: var(--primary-color);
      }

      .dashboard-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        cursor: pointer;
        transition: background-color 0.3s;
        text-decoration: none;
        display: inline-block;
      }

      .btn:hover {
        background-color: #0d1b69;
      }

      .btn-secondary {
        background-color: var(--secondary-color);
      }

      .btn-secondary:hover {
        background-color: #2980b9;
      }

      .btn-danger {
        background-color: var(--danger-color);
      }

      .btn-danger:hover {
        background-color: #c0392b;
      }

      .customer-list {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 20px;
      }

      .customer-list table {
        width: 100%;
        border-collapse: collapse;
      }

      .customer-list th,
      .customer-list td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .customer-list th {
        background-color: #f1f5f9;
        font-weight: 500;
      }

      .customer-list tr:hover {
        background-color: #f9f9f9;
        cursor: pointer;
      }

      .action-cell {
        width: 100px;
      }

      .customer-details {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-top: 20px;
        display: none;
      }

      .customer-details h3 {
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .customer-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .info-item {
        margin-bottom: 10px;
      }

      .info-label {
        font-weight: 500;
        color: var(--light-text);
        font-size: 0.9rem;
      }

      .info-value {
        font-size: 1.1rem;
      }

      .back-btn {
        margin-right: 10px;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: var(--card-background);
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
      }

      .modal-title {
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: var(--text-color);
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 1rem;
        color: var(--text-color);
      }

      .form-control:focus {
        border-color: var(--secondary-color);
        outline: none;
      }

      .user-section {
        margin-bottom: 30px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .section-title {
        font-size: 1.3rem;
        color: var(--primary-color);
        margin: 0;
        padding: 15px;
      }

      .user-list {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 20px;
      }

      .user-list table {
        width: 100%;
        border-collapse: collapse;
      }

      .user-list th,
      .user-list td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .user-list th {
        background-color: #f1f5f9;
        font-weight: 500;
      }

      .user-list tr:hover {
        background-color: #f9f9f9;
        cursor: pointer;
      }

      .tab-container {
        margin-bottom: 20px;
      }

      .tab-buttons {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .tab-button {
        background: none;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
        font-weight: 500;
      }

      .tab-button:hover {
        background-color: rgba(0, 0, 0, 0.03);
      }

      .tab-button.active {
        border-bottom: 3px solid var(--primary-color);
        color: var(--primary-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="container">
        <div class="logo">VeloRent Admin</div>
        <div class="nav-links">
          <a href="#">Dashboard</a>
          <a href="#">Vehicles</a>
          <a href="#">Reservations</a>
          <a href="#">Reports</a>
          <a href="/logout">Logout</a>
        </div>
      </nav>
    </header>

    <main class="container">
      <div class="dashboard-header">
        <h1 class="dashboard-title">Admin Dashboard</h1>
        <div class="dashboard-actions">
          <a href="/dashboard" class="btn back-btn">Back to Dashboard</a>
          <button class="btn btn-secondary" id="refreshBtn">Refresh Data</button>
        </div>
      </div>

      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="customers">Customers</button>
          <button class="tab-button" data-tab="fleet-managers">Fleet Managers</button>
          <button class="tab-button" data-tab="system-admins">System Administrators</button>
          <button class="tab-button" data-tab="owners">Owners</button>
        </div>

        <div class="tab-content active" id="customers-tab">
          <section class="user-list customer-list">
            <div class="section-header">
              <h2 class="section-title">Customer List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="customerTableBody">
                <!-- Customer data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="fleet-managers-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">Fleet Manager List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Department</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="fleetManagerTableBody">
                <!-- Fleet manager data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="system-admins-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">System Administrator List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Position</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="systemAdminTableBody">
                <!-- System admin data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="owners-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">Owner List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="ownerTableBody">
                <!-- Owner data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>
      </div>

      <section class="customer-details" id="customerDetails">
        <h3>Customer Details</h3>
        <div class="customer-info">
          <div class="info-item">
            <div class="info-label">First Name</div>
            <div class="info-value" id="firstName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Name</div>
            <div class="info-value" id="lastName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="email"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Contact Number</div>
            <div class="info-value" id="contactNumber"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Street Address</div>
            <div class="info-value" id="street"></div>
          </div>
          <div class="info-item">
            <div class="info-label">City</div>
            <div class="info-value" id="city"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Postal Code</div>
            <div class="info-value" id="postalCode"></div>
          </div>
        </div>
      </section>

      <!-- User Details Section -->
      <section class="customer-details" id="userDetails" style="display: none;">
        <h3>User Details</h3>
        <div class="customer-info">
          <div class="info-item">
            <div class="info-label">First Name</div>
            <div class="info-value" id="userFirstName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Name</div>
            <div class="info-value" id="userLastName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="userEmail"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Role</div>
            <div class="info-value" id="userRole"></div>
          </div>
          <div class="info-item" id="departmentItem" style="display: none;">
            <div class="info-label">Department</div>
            <div class="info-value" id="userDepartment"></div>
          </div>
          <div class="info-item" id="positionItem" style="display: none;">
            <div class="info-label">Position</div>
            <div class="info-value" id="userPosition"></div>
          </div>
          <div class="info-item" id="employeeIdItem" style="display: none;">
            <div class="info-label">Employee ID</div>
            <div class="info-value" id="userEmployeeId"></div>
          </div>
        </div>
      </section>

      <!-- Delete Confirmation Modal -->
      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Confirm Delete</h3>
          <p>Are you sure you want to delete this customer account? This action cannot be undone.</p>
          <div class="modal-actions">
            <button id="cancelDeleteBtn" class="btn">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>

      <!-- Edit Customer Modal -->
      <div id="editModal" class="modal">
        <div class="modal-content" style="width: 500px; max-width: 95%;">
          <h3 class="modal-title">Edit Customer</h3>
          <form id="editCustomerForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label for="editFirstName">First Name</label>
                <input type="text" id="editFirstName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editLastName">Last Name</label>
                <input type="text" id="editLastName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editContactNumber">Phone Number</label>
                <input type="text" id="editContactNumber" class="form-control">
              </div>
              <div class="form-group">
                <label for="editStreet">Street Address</label>
                <input type="text" id="editStreet" class="form-control">
              </div>
              <div class="form-group">
                <label for="editCity">City</label>
                <input type="text" id="editCity" class="form-control">
              </div>
              <div class="form-group">
                <label for="editPostalCode">Postal Code</label>
                <input type="text" id="editPostalCode" class="form-control">
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" id="cancelEditBtn" class="btn">Cancel</button>
              <button type="submit" class="btn btn-secondary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Change Role Modal -->
      <div id="changeRoleModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Change User Role</h3>
          <p>Select a new role for <span id="changeRoleUserName">this user</span>:</p>
          <div class="form-group">
            <label for="roleSelect">Role</label>
            <select id="roleSelect" class="form-control">
              <!-- Roles will be loaded dynamically -->
            </select>
          </div>
          <div class="modal-actions">
            <button id="cancelChangeRoleBtn" class="btn">Cancel</button>
            <button id="confirmChangeRoleBtn" class="btn btn-secondary">Change Role</button>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadCustomers();
        loadFleetManagers();
        loadSystemAdmins();
        loadOwners();
        loadRoles(); // Load available roles for the role changing feature

        // Add event listener for refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
          loadCustomers();
          loadFleetManagers();
          loadSystemAdmins();
          loadOwners();
        });

        // Modal event listeners
        document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
          document.getElementById('deleteModal').style.display = 'none';
        });

        document.getElementById('cancelEditBtn').addEventListener('click', function() {
          document.getElementById('editModal').style.display = 'none';
        });

        document.getElementById('cancelChangeRoleBtn').addEventListener('click', function() {
          document.getElementById('changeRoleModal').style.display = 'none';
        });

        document.getElementById('confirmChangeRoleBtn').addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          const roleId = document.getElementById('roleSelect').value;
          if (userId && roleId) {
            changeUserRole(userId, roleId);
          }
        });

        // Tab switching functionality
        document.querySelectorAll('.tab-button').forEach(button => {
          button.addEventListener('click', function() {
            // Remove active class from all buttons and tab contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to clicked button
            this.classList.add('active');

            // Show the corresponding tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId + '-tab').classList.add('active');

            // Hide any open details panels
            document.getElementById('customerDetails').style.display = 'none';
            document.getElementById('userDetails').style.display = 'none';
          });
        });
      });

      // Global variable to store all roles
      let availableRoles = [];

      function loadRoles() {
        fetch('/api/admin/roles', {
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load roles');
          }
          return response.json();
        })
        .then(roles => {
          availableRoles = roles;
        })
        .catch(error => {
          console.error('Error loading roles:', error);
        });
      }

      function createActionButtons(user) {
        const actionCell = document.createElement('td');
        actionCell.classList.add('action-cell');

        // Create details button
        const detailsButton = document.createElement('button');
        detailsButton.textContent = 'Details';
        detailsButton.classList.add('btn', 'btn-secondary');
        detailsButton.style.marginRight = '5px';
        detailsButton.onclick = function(e) {
          e.stopPropagation(); // Prevent row click event
          showUserDetails(user.id);
        };

        // Create change role button
        const changeRoleButton = document.createElement('button');
        changeRoleButton.textContent = 'Change Role';
        changeRoleButton.classList.add('btn');
        changeRoleButton.style.marginRight = '5px';
        changeRoleButton.onclick = function(e) {
          e.stopPropagation(); // Prevent row click event
          showChangeRoleModal(user.id, `${user.firstName} ${user.lastName}`, user.role);
        };

        actionCell.appendChild(detailsButton);
        actionCell.appendChild(changeRoleButton);

        return actionCell;
      }

      function showChangeRoleModal(userId, userName, currentRole) {
        // Set user name in the modal
        document.getElementById('changeRoleUserName').textContent = userName;

        // Populate role dropdown
        const roleSelect = document.getElementById('roleSelect');
        roleSelect.innerHTML = '';

        if (availableRoles.length === 0) {
          // If roles haven't been loaded yet, load them now
          fetch('/api/admin/roles', {
            credentials: 'include'
          })
          .then(response => response.json())
          .then(roles => {
            availableRoles = roles;
            populateRoleDropdown(roleSelect, currentRole);
          });
        } else {
          populateRoleDropdown(roleSelect, currentRole);
        }

        // Set user ID on the confirm button
        document.getElementById('confirmChangeRoleBtn').setAttribute('data-user-id', userId);

        // Show the modal
        document.getElementById('changeRoleModal').style.display = 'block';
      }

      function populateRoleDropdown(selectElement, currentRole) {
        availableRoles.forEach(role => {
          const option = document.createElement('option');
          option.value = role.id;
          option.textContent = role.name.replace('ROLE_', '');

          // Select the current role
          if (role.name === currentRole) {
            option.selected = true;
          }

          selectElement.appendChild(option);
        });
      }

      function changeUserRole(userId, roleId) {
        fetch(`/api/admin/users/${userId}/role`, {
          method: 'PUT',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ roleId: parseInt(roleId) })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update user role');
          }
          return response.json();
        })
        .then(updatedUser => {
          // Hide the modal
          document.getElementById('changeRoleModal').style.display = 'none';

          // Reload all user lists to reflect the change
          loadCustomers();
          loadFleetManagers();
          loadSystemAdmins();
          loadOwners();

          // Show success message
          alert('User role updated successfully');

          // Update user details if currently shown
          if (document.getElementById('userDetails').style.display === 'block') {
            showUserDetails(userId);
          }
        })
        .catch(error => {
          console.error('Error updating user role:', error);
          alert('Failed to update user role. Please try again later.');
        });
      }

      function loadCustomers() {
        fetch('/api/admin/customers', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customers');
            }
            return response.json();
          })
          .then(customers => {
            const tableBody = document.getElementById('customerTableBody');
            tableBody.innerHTML = '';

            customers.forEach(customer => {
              const row = document.createElement('tr');

              // Create cells for customer info
              const idCell = document.createElement('td');
              idCell.textContent = customer.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${customer.firstName} ${customer.lastName}`;
              nameCell.classList.add('customer-name');

              const emailCell = document.createElement('td');
              emailCell.textContent = customer.email;

              const actionCell = document.createElement('td');
              actionCell.classList.add('action-cell');

              // Create edit button
              const editButton = document.createElement('button');
              editButton.textContent = 'Edit';
              editButton.classList.add('btn', 'btn-secondary');
              editButton.style.marginRight = '5px';
              editButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showEditForm(customer.id);
              };

              // Create delete button
              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Delete';
              deleteButton.classList.add('btn', 'btn-danger');
              deleteButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showDeleteConfirmation(customer.id);
              };

              actionCell.appendChild(editButton);
              actionCell.appendChild(deleteButton);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(actionCell);

              // Add click event to show customer details (exclude action cell)
              nameCell.addEventListener('click', () => showCustomerDetails(customer.id));
              idCell.addEventListener('click', () => showCustomerDetails(customer.id));
              emailCell.addEventListener('click', () => showCustomerDetails(customer.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading customers:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function loadFleetManagers() {
        fetch('/api/admin/users/fleet-managers', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load fleet managers');
            }
            return response.json();
          })
          .then(fleetManagers => {
            const tableBody = document.getElementById('fleetManagerTableBody');
            tableBody.innerHTML = '';

            fleetManagers.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;

              const deptCell = document.createElement('td');
              deptCell.textContent = user.staffIdCode || 'N/A';

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(deptCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading fleet managers:', error);
            alert('Failed to load fleet manager data. Please try again later.');
          });
      }

      function loadSystemAdmins() {
        fetch('/api/admin/users/system-admins', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load system admins');
            }
            return response.json();
          })
          .then(systemAdmins => {
            const tableBody = document.getElementById('systemAdminTableBody');
            tableBody.innerHTML = '';

            systemAdmins.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;

              const positionCell = document.createElement('td');
              positionCell.textContent = user.staffIdCode || 'N/A';

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(positionCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading system admins:', error);
            alert('Failed to load system admin data. Please try again later.');
          });
      }

      function loadOwners() {
        fetch('/api/admin/users/owners', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load owners');
            }
            return response.json();
          })
          .then(owners => {
            const tableBody = document.getElementById('ownerTableBody');
            tableBody.innerHTML = '';

            owners.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading owners:', error);
            alert('Failed to load owner data. Please try again later.');
          });
      }

      function showUserDetails(userId) {
        fetch(`/api/admin/users/${userId}`, {
          credentials: 'include'
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load user details');
            }
            return response.json();
          })
          .then(user => {
            // Hide customer details if showing
            document.getElementById('customerDetails').style.display = 'none';

            // Populate user details
            document.getElementById('userFirstName').textContent = user.firstName || 'N/A';
            document.getElementById('userLastName').textContent = user.lastName || 'N/A';
            document.getElementById('userEmail').textContent = user.email || 'N/A';
            document.getElementById('userRole').textContent = user.role || 'N/A';

            // Handle staff-specific fields
            const departmentItem = document.getElementById('departmentItem');
            const positionItem = document.getElementById('positionItem');
            const employeeIdItem = document.getElementById('employeeIdItem');

            if (user.department) {
              document.getElementById('userDepartment').textContent = user.department;
              departmentItem.style.display = 'block';
            } else {
              departmentItem.style.display = 'none';
            }

            if (user.position) {
              document.getElementById('userPosition').textContent = user.position;
              positionItem.style.display = 'block';
            } else {
              positionItem.style.display = 'none';
            }

            if (user.employeeId) {
              document.getElementById('userEmployeeId').textContent = user.employeeId;
              employeeIdItem.style.display = 'block';
            } else {
              employeeIdItem.style.display = 'none';
            }

            // Show the details section
            document.getElementById('userDetails').style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading user details:', error);
            alert('Failed to load user details. Please try again later.');
          });
      }

      function showCustomerDetails(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer details');
            }
            return response.json();
          })
          .then(customer => {
            // Populate customer details
            document.getElementById('firstName').textContent = customer.firstName || 'N/A';
            document.getElementById('lastName').textContent = customer.lastName || 'N/A';
            document.getElementById('email').textContent = customer.email || 'N/A';
            document.getElementById('contactNumber').textContent = customer.contactNumber || 'N/A';
            document.getElementById('street').textContent = customer.addressStreet || 'N/A';
            document.getElementById('city').textContent = customer.addressCity || 'N/A';
            document.getElementById('postalCode').textContent = customer.addressPostalCode || 'N/A';

            // Show the details section
            document.getElementById('customerDetails').style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading customer details:', error);
            alert('Failed to load customer details. Please try again later.');
          });
      }

      function showDeleteConfirmation(customerId) {
        // Store the customer ID in the confirm button's data attribute
        document.getElementById('confirmDeleteBtn').setAttribute('data-customer-id', customerId);

        // Display the modal
        document.getElementById('deleteModal').style.display = 'block';

        // Set up the confirm delete button
        document.getElementById('confirmDeleteBtn').onclick = function() {
          deleteCustomer(customerId);
        };
      }

      function deleteCustomer(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'DELETE',
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to delete customer');
          }
          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Hide customer details if currently shown
          document.getElementById('customerDetails').style.display = 'none';

          // Show success message
          alert('Customer deleted successfully');
        })
        .catch(error => {
          console.error('Error deleting customer:', error);
          alert('Failed to delete customer. Please try again later.');

          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';
        });
      }

      function showEditForm(customerId) {
        // Fetch customer data and populate the edit form
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer data for editing');
            }
            return response.json();
          })
          .then(customer => {
            // Populate the form fields with customer data
            document.getElementById('editFirstName').value = customer.firstName || '';
            document.getElementById('editLastName').value = customer.lastName || '';
            document.getElementById('editEmail').value = customer.email || '';
            document.getElementById('editContactNumber').value = customer.contactNumber || '';
            document.getElementById('editStreet').value = customer.addressStreet || '';
            document.getElementById('editCity').value = customer.addressCity || '';
            document.getElementById('editPostalCode').value = customer.addressPostalCode || '';

            // Display the edit modal
            document.getElementById('editModal').style.display = 'block';

            // Handle form submission
            const form = document.getElementById('editCustomerForm');
            form.onsubmit = function(e) {
              e.preventDefault(); // Prevent default form submission

              // Gather updated customer data from the form
              const updatedCustomer = {
                firstName: document.getElementById('editFirstName').value,
                lastName: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                contactNumber: document.getElementById('editContactNumber').value,
                addressStreet: document.getElementById('editStreet').value,
                addressCity: document.getElementById('editCity').value,
                addressPostalCode: document.getElementById('editPostalCode').value
              };

              // Send the updated data to the server
              updateCustomer(customerId, updatedCustomer);
            };
          })
          .catch(error => {
            console.error('Error loading customer data for editing:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function updateCustomer(customerId, customerData) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'PUT',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(customerData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update customer data');
          }
          return response.json();
        })
        .then(data => {
          // Hide the modal
          document.getElementById('editModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Update customer details if currently shown
          if (document.getElementById('customerDetails').style.display === 'block') {
            showCustomerDetails(customerId);
          }

          // Show success message
          alert('Customer data updated successfully');
        })
        .catch(error => {
          console.error('Error updating customer data:', error);
          alert('Failed to update customer data. Please try again later.');
        });
      }
    </script>
  </body>
</html>
