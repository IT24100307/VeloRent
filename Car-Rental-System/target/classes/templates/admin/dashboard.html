<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Car Rental System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #1a237e;
        --secondary-color: #3498db;
        --accent-color: #2ecc71;
        --danger-color: #e74c3c;
        --text-color: #333;
        --light-text: #666;
        --background-color: #f8f9fa;
        --card-background: #fff;
        --border-color: #e1e1e1;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Roboto", "Segoe UI", Arial, sans-serif;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background-color: var(--primary-color);
        color: white;
        padding: 1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .nav-links {
        display: flex;
        gap: 20px;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        padding: 8px 15px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      .nav-links a:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      main {
        margin-top: 30px;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .dashboard-title {
        font-size: 24px;
        color: var(--primary-color);
      }

      .dashboard-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        cursor: pointer;
        transition: background-color 0.3s;
        text-decoration: none;
        display: inline-block;
      }

      .btn:hover {
        background-color: #0d1b69;
      }

      .btn-secondary {
        background-color: var(--secondary-color);
      }

      .btn-secondary:hover {
        background-color: #2980b9;
      }

      .btn-danger {
        background-color: var(--danger-color);
      }

      .btn-danger:hover {
        background-color: #c0392b;
      }

      .customer-list {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 20px;
      }

      .customer-list table {
        width: 100%;
        border-collapse: collapse;
      }

      .customer-list th,
      .customer-list td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .customer-list th {
        background-color: #f1f5f9;
        font-weight: 500;
      }

      .customer-list tr:hover {
        background-color: #f9f9f9;
        cursor: pointer;
      }

      .action-cell {
        width: 100px;
      }

      .customer-details {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-top: 20px;
        display: none;
      }

      .customer-details h3 {
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .customer-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .info-item {
        margin-bottom: 10px;
      }

      .info-label {
        font-weight: 500;
        color: var(--light-text);
        font-size: 0.9rem;
      }

      .info-value {
        font-size: 1.1rem;
      }

      .back-btn {
        margin-right: 10px;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: var(--card-background);
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
      }

      .modal-title {
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: var(--text-color);
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 1rem;
        color: var(--text-color);
      }

      .form-control:focus {
        border-color: var(--secondary-color);
        outline: none;
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="container">
        <div class="logo">VeloRent Admin</div>
        <div class="nav-links">
          <a href="#">Dashboard</a>
          <a href="#">Vehicles</a>
          <a href="#">Reservations</a>
          <a href="#">Reports</a>
          <a href="/logout">Logout</a>
        </div>
      </nav>
    </header>

    <main class="container">
      <div class="dashboard-header">
        <h1 class="dashboard-title">Admin Dashboard</h1>
        <div class="dashboard-actions">
          <a href="/dashboard" class="btn back-btn">Back to Dashboard</a>
          <button class="btn btn-secondary" id="refreshBtn">Refresh Data</button>
        </div>
      </div>

      <section class="customer-list">
        <h2 style="padding: 15px">Customer List</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th class="action-cell">Actions</th>
            </tr>
          </thead>
          <tbody id="customerTableBody">
            <!-- Customer data will be loaded here -->
          </tbody>
        </table>
      </section>

      <section class="customer-details" id="customerDetails">
        <h3>Customer Details</h3>
        <div class="customer-info">
          <div class="info-item">
            <div class="info-label">First Name</div>
            <div class="info-value" id="firstName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Name</div>
            <div class="info-value" id="lastName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="email"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Contact Number</div>
            <div class="info-value" id="contactNumber"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Street Address</div>
            <div class="info-value" id="street"></div>
          </div>
          <div class="info-item">
            <div class="info-label">City</div>
            <div class="info-value" id="city"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Postal Code</div>
            <div class="info-value" id="postalCode"></div>
          </div>
        </div>
      </section>

      <!-- Delete Confirmation Modal -->
      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Confirm Delete</h3>
          <p>Are you sure you want to delete this customer account? This action cannot be undone.</p>
          <div class="modal-actions">
            <button id="cancelDeleteBtn" class="btn">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>

      <!-- Edit Customer Modal -->
      <div id="editModal" class="modal">
        <div class="modal-content" style="width: 500px; max-width: 95%;">
          <h3 class="modal-title">Edit Customer</h3>
          <form id="editCustomerForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label for="editFirstName">First Name</label>
                <input type="text" id="editFirstName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editLastName">Last Name</label>
                <input type="text" id="editLastName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editContactNumber">Phone Number</label>
                <input type="text" id="editContactNumber" class="form-control">
              </div>
              <div class="form-group">
                <label for="editStreet">Street Address</label>
                <input type="text" id="editStreet" class="form-control">
              </div>
              <div class="form-group">
                <label for="editCity">City</label>
                <input type="text" id="editCity" class="form-control">
              </div>
              <div class="form-group">
                <label for="editPostalCode">Postal Code</label>
                <input type="text" id="editPostalCode" class="form-control">
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" id="cancelEditBtn" class="btn">Cancel</button>
              <button type="submit" class="btn btn-secondary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadCustomers();

        // Add event listener for refresh button
        document.getElementById('refreshBtn').addEventListener('click', loadCustomers);

        // Modal event listeners
        document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
          document.getElementById('deleteModal').style.display = 'none';
        });

        document.getElementById('cancelEditBtn').addEventListener('click', function() {
          document.getElementById('editModal').style.display = 'none';
        });
      });

      function loadCustomers() {
        fetch('/api/admin/customers', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customers');
            }
            return response.json();
          })
          .then(customers => {
            const tableBody = document.getElementById('customerTableBody');
            tableBody.innerHTML = '';

            customers.forEach(customer => {
              const row = document.createElement('tr');

              // Create cells for customer info
              const idCell = document.createElement('td');
              idCell.textContent = customer.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${customer.firstName} ${customer.lastName}`;
              nameCell.classList.add('customer-name');

              const emailCell = document.createElement('td');
              emailCell.textContent = customer.email;

              const actionCell = document.createElement('td');
              actionCell.classList.add('action-cell');

              // Create edit button
              const editButton = document.createElement('button');
              editButton.textContent = 'Edit';
              editButton.classList.add('btn', 'btn-secondary');
              editButton.style.marginRight = '5px';
              editButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showEditForm(customer.id);
              };

              // Create delete button
              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Delete';
              deleteButton.classList.add('btn', 'btn-danger');
              deleteButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showDeleteConfirmation(customer.id);
              };

              actionCell.appendChild(editButton);
              actionCell.appendChild(deleteButton);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(actionCell);

              // Add click event to show customer details (exclude action cell)
              nameCell.addEventListener('click', () => showCustomerDetails(customer.id));
              idCell.addEventListener('click', () => showCustomerDetails(customer.id));
              emailCell.addEventListener('click', () => showCustomerDetails(customer.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading customers:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function showCustomerDetails(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer details');
            }
            return response.json();
          })
          .then(customer => {
            // Populate customer details
            document.getElementById('firstName').textContent = customer.firstName || 'N/A';
            document.getElementById('lastName').textContent = customer.lastName || 'N/A';
            document.getElementById('email').textContent = customer.email || 'N/A';
            document.getElementById('contactNumber').textContent = customer.contactNumber || 'N/A';
            document.getElementById('street').textContent = customer.addressStreet || 'N/A';
            document.getElementById('city').textContent = customer.addressCity || 'N/A';
            document.getElementById('postalCode').textContent = customer.addressPostalCode || 'N/A';

            // Show the details section
            document.getElementById('customerDetails').style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading customer details:', error);
            alert('Failed to load customer details. Please try again later.');
          });
      }

      function showDeleteConfirmation(customerId) {
        // Store the customer ID in the confirm button's data attribute
        document.getElementById('confirmDeleteBtn').setAttribute('data-customer-id', customerId);

        // Display the modal
        document.getElementById('deleteModal').style.display = 'block';

        // Set up the confirm delete button
        document.getElementById('confirmDeleteBtn').onclick = function() {
          deleteCustomer(customerId);
        };
      }

      function deleteCustomer(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'DELETE',
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to delete customer');
          }
          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Hide customer details if currently shown
          document.getElementById('customerDetails').style.display = 'none';

          // Show success message
          alert('Customer deleted successfully');
        })
        .catch(error => {
          console.error('Error deleting customer:', error);
          alert('Failed to delete customer. Please try again later.');

          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';
        });
      }

      function showEditForm(customerId) {
        // Fetch customer data and populate the edit form
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer data for editing');
            }
            return response.json();
          })
          .then(customer => {
            // Populate the form fields with customer data
            document.getElementById('editFirstName').value = customer.firstName || '';
            document.getElementById('editLastName').value = customer.lastName || '';
            document.getElementById('editEmail').value = customer.email || '';
            document.getElementById('editContactNumber').value = customer.contactNumber || '';
            document.getElementById('editStreet').value = customer.addressStreet || '';
            document.getElementById('editCity').value = customer.addressCity || '';
            document.getElementById('editPostalCode').value = customer.addressPostalCode || '';

            // Display the edit modal
            document.getElementById('editModal').style.display = 'block';

            // Handle form submission
            const form = document.getElementById('editCustomerForm');
            form.onsubmit = function(e) {
              e.preventDefault(); // Prevent default form submission

              // Gather updated customer data from the form
              const updatedCustomer = {
                firstName: document.getElementById('editFirstName').value,
                lastName: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                contactNumber: document.getElementById('editContactNumber').value,
                addressStreet: document.getElementById('editStreet').value,
                addressCity: document.getElementById('editCity').value,
                addressPostalCode: document.getElementById('editPostalCode').value
              };

              // Send the updated data to the server
              updateCustomer(customerId, updatedCustomer);
            };
          })
          .catch(error => {
            console.error('Error loading customer data for editing:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function updateCustomer(customerId, customerData) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'PUT',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(customerData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update customer data');
          }
          return response.json();
        })
        .then(data => {
          // Hide the modal
          document.getElementById('editModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Update customer details if currently shown
          if (document.getElementById('customerDetails').style.display === 'block') {
            showCustomerDetails(customerId);
          }

          // Show success message
          alert('Customer data updated successfully');
        })
        .catch(error => {
          console.error('Error updating customer data:', error);
          alert('Failed to update customer data. Please try again later.');
        });
      }
    </script>
  </body>
</html>

