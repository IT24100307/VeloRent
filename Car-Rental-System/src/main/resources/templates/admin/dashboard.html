<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | VeloRent - Luxury Car Rental</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css" />
    <!-- Luxury Theme CSS (Main styling) -->
    <link rel="stylesheet" href="/css/luxury-theme.css" />
    <!-- Bootstrap CSS (Secondary for grid system) -->
    <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="/css/DataTables/datatables.min.css" />
    <script src="/js/jQuery/jquery-3.7.1.min.js"></script>
    <style>
      /* Admin Dashboard Luxury Theme Overrides */

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: var(--font-luxury-secondary);
      }

      body {
        background: var(--luxury-black) !important;
        color: var(--text-luxury-light) !important;
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background: var(--luxury-charcoal);
        color: var(--text-luxury-light);
        padding: 1rem;
        box-shadow: var(--shadow-luxury);
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
      }

      .nav-links {
        display: flex;
        gap: 20px;
      }

      .nav-links a {
        color: var(--text-luxury-light);
        text-decoration: none;
        padding: 10px 18px;
        border-radius: var(--radius-luxury-small);
        transition: var(--transition-smooth);
        font-weight: 500;
        border: 1px solid transparent;
      }

      .nav-links a:hover {
        background: var(--luxury-gold);
        color: var(--luxury-black);
        border-color: var(--luxury-gold);
        transform: translateY(-1px);
      }

      main {
        margin-top: 30px;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 20px 0;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      }

      .dashboard-title {
        font-size: 28px;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
        font-weight: 700;
        display: flex;
        align-items: center;
      }
      
      .dashboard-title::before {
        content: '\f3fd';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        margin-right: 15px;
        color: var(--luxury-gold);
        font-size: 1.2em;
      }

      .dashboard-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        background: var(--gradient-gold);
        color: var(--luxury-black);
        border: none;
        border-radius: var(--radius-luxury-small);
        padding: 12px 20px;
        cursor: pointer;
        transition: var(--transition-smooth);
        text-decoration: none;
        display: inline-block;
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .btn:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-luxury);
      }

      .btn-secondary {
        background: transparent;
        color: var(--luxury-gold);
        border: 2px solid var(--luxury-gold);
      }

      .btn-secondary:hover {
        background: var(--luxury-gold);
        color: var(--luxury-black);
      }

      .btn-danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
      }

      .customer-list, .user-list {
        background: var(--luxury-charcoal);
        border-radius: var(--radius-luxury-large);
        box-shadow: var(--shadow-luxury);
        overflow: hidden;
        margin-bottom: 30px;
        border: 1px solid rgba(212, 175, 55, 0.2);
        backdrop-filter: blur(10px);
      }

      .customer-list table, .user-list table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
      }

      .customer-list th,
      .customer-list td,
      .user-list th,
      .user-list td {
        padding: 20px 25px;
        text-align: left;
        border-bottom: 1px solid rgba(212, 175, 55, 0.08);
        color: var(--text-luxury-light);
        vertical-align: middle;
        position: relative;
      }

      .customer-list th,
      .user-list th {
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 100%);
        font-weight: 700;
        color: var(--luxury-gold);
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 1.2px;
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 2px solid var(--luxury-gold);
      }

      .customer-list th::before,
      .user-list th::before {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent 0%, var(--luxury-gold) 50%, transparent 100%);
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      .customer-list tbody tr,
      .user-list tbody tr {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: var(--radius-luxury-small);
      }

      .customer-list tbody tr:hover,
      .user-list tbody tr:hover {
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0.05) 100%);
        cursor: pointer;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
      }

      .customer-list tbody tr:last-child td,
      .user-list tbody tr:last-child td {
        border-bottom: none;
      }

      /* Add user icons and styling */
      .user-id-cell {
        font-weight: 700;
        color: var(--luxury-gold);
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
      }

      .user-name-cell {
        font-weight: 600;
        font-size: 1.05rem;
        position: relative;
      }

      .user-name-cell::before {
        content: '\f007';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        margin-right: 10px;
        color: var(--luxury-gold);
        opacity: 0.7;
      }

      .user-email-cell {
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
        color: var(--text-luxury-muted);
      }

      .user-role-cell {
        position: relative;
      }

      .user-role-cell::before {
        content: '\f2bd';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        margin-right: 8px;
        color: var(--luxury-gold);
        opacity: 0.7;
      }

      .action-cell {
        width: 180px;
        text-align: center;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }

      .btn-action {
        padding: 8px 16px;
        font-size: 0.85rem;
        border-radius: var(--radius-luxury-small);
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .btn-action::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .btn-action:hover::before {
        left: 100%;
      }

      .btn-details {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }

      .btn-details:hover {
        background: linear-gradient(135deg, #2980b9 0%, #1f5c8a 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
      }

      .btn-edit {
        background: var(--gradient-gold);
        color: var(--luxury-black);
      }

      .btn-edit:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      }

      .btn-delete {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      .btn-delete:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      .btn-role {
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        color: white;
      }

      .btn-role:hover {
        background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
      }

      .customer-details {
        background: var(--luxury-charcoal);
        border-radius: var(--radius-luxury-large);
        box-shadow: var(--shadow-luxury);
        padding: 25px;
        margin-top: 20px;
        display: none;
        border: 1px solid rgba(212, 175, 55, 0.2);
      }

      .customer-details h3 {
        margin-bottom: 20px;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
        font-size: 1.4rem;
      }

      .customer-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .info-item {
        margin-bottom: 10px;
      }

      .info-label {
        font-weight: 600;
        color: var(--text-luxury-muted);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 1.1rem;
        color: var(--text-luxury-light);
      }

      .back-btn {
        margin-right: 10px;
      }

      /* Modal overlay + content: high-contrast and centered */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000; /* above sticky headers and tables */
        inset: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.75); /* darker for readability */
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        padding: 24px;
        display: none;
        /* Center content */
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: linear-gradient(180deg, rgba(18,18,18,1) 0%, rgba(10,10,10,1) 100%);
        color: var(--text-luxury-light);
        border: 1px solid rgba(212, 175, 55, 0.25);
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.7);
        border-radius: 12px;
        padding: 22px 22px 16px 22px;
        margin: 0 auto;
        width: 520px;
        max-width: 95vw;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-title {
        margin-bottom: 15px;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
        font-weight: 700;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: var(--text-luxury-light);
        letter-spacing: 0.3px;
      }

      .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid rgba(212, 175, 55, 0.35);
        border-radius: 8px;
        font-size: 1rem;
        background: #0f0f0f;
        color: #f2f2f2;
      }

      .form-control::placeholder {
        color: #a8a8a8;
        opacity: 1;
      }

      .form-control:focus {
        border-color: var(--luxury-gold);
        outline: none;
        box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.15);
      }

      .user-section {
        margin-bottom: 30px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0;
        padding: 25px 30px;
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 50%, var(--luxury-black) 100%);
        border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        position: relative;
      }

      .section-header::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 2px;
        background: var(--gradient-gold);
        border-radius: 2px;
      }

      .section-title {
        font-size: 1.4rem;
        color: var(--luxury-gold);
        margin: 0;
        padding: 0;
        font-family: var(--font-luxury-primary);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        position: relative;
      }

      .section-title i {
        margin-right: 15px;
        font-size: 1.2em;
        background: var(--gradient-gold);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .user-list {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 20px;
      }

      .user-list table {
        width: 100%;
        border-collapse: collapse;
      }

      .user-list th,
      .user-list td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .user-list th {
        background-color: #f1f5f9;
        font-weight: 500;
      }

      .user-list tr:hover {
        background-color: #f9f9f9;
        cursor: pointer;
      }

      .tab-container {
        margin-bottom: 20px;
      }

      .tab-buttons {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .tab-button {
        background: transparent;
        border: none;
        padding: 15px 25px;
        font-size: 1rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: var(--transition-smooth);
        font-weight: 600;
        color: var(--text-luxury-gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: var(--radius-luxury-small) var(--radius-luxury-small) 0 0;
      }

      .tab-button:hover {
        background: rgba(212, 175, 55, 0.1);
        color: var(--luxury-gold);
      }

      .tab-button.active {
        border-bottom: 3px solid var(--luxury-gold);
        color: var(--luxury-gold);
        background: rgba(212, 175, 55, 0.1);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Make primary action prominent inside modals */
      .modal-actions .btn-secondary {
        background: var(--gradient-gold);
        color: var(--luxury-black);
        border: none;
      }
      .modal-actions .btn-secondary:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-luxury);
      }
      
      /* DataTables Luxury Theme Overrides */
      .dataTables_wrapper {
        color: var(--text-luxury-light) !important;
      }
      
      .dataTables_filter input {
        background: var(--luxury-black) !important;
        color: var(--text-luxury-light) !important;
        border: 1px solid rgba(212, 175, 55, 0.3) !important;
        border-radius: var(--radius-luxury-small) !important;
        padding: 8px 12px !important;
      }
      
      .dataTables_length select {
        background: var(--luxury-black) !important;
        color: var(--text-luxury-light) !important;
        border: 1px solid rgba(212, 175, 55, 0.3) !important;
        border-radius: var(--radius-luxury-small) !important;
      }
      
      .dataTables_info {
        color: var(--text-luxury-muted) !important;
      }
      
      .paginate_button {
        background: var(--luxury-charcoal) !important;
        color: var(--text-luxury-light) !important;
        border: 1px solid rgba(212, 175, 55, 0.2) !important;
        border-radius: var(--radius-luxury-small) !important;
        margin: 0 2px !important;
      }
      
      .paginate_button:hover {
        background: var(--luxury-gold) !important;
        color: var(--luxury-black) !important;
      }
      
      .paginate_button.current {
        background: var(--luxury-gold) !important;
        color: var(--luxury-black) !important;
      }
    </style>
  </head>
  <body>
    <!-- Page Loader -->
    <div class="page-loader">
      <div class="loader-content">
        <div class="loader-spinner"></div>
        <div class="loader-text">VeloRent Admin</div>
      </div>
    </div>

    <header>
      <nav class="container">
        <div class="logo">
          <i class="fas fa-crown mr-2"></i>VeloRent Admin
        </div>
        <div class="nav-links" style="align-items:center; gap: 12px;">
          <a href="/admin/dashboard"><i class="fas fa-tachometer-alt mr-1"></i>Dashboard</a>
          <a href="/admin/feedback"><i class="fas fa-comments mr-1"></i>Feedback</a>
          <!-- Admin notifications removed -->
          <div class="dropdown">
            <button class="btn-luxury btn-luxury-outline dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false" title="Account">
              <span id="admin-user-initials">AD</span>
            </button>
            <div class="dropdown-menu dropdown-menu-right" style="background: var(--luxury-dark); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: var(--radius-luxury); min-width: 240px;">
              <div class="dropdown-item-text" style="color: var(--luxury-gold); font-weight: 600; padding: 0.75rem 1rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                <div id="admin-user-name">System Admin</div>
                <small id="admin-user-email" style="color: var(--text-luxury-muted);">admin@velorent.com</small>
              </div>
              <a class="dropdown-item" href="/profile" id="admin-profile-dropdown-link" style="color: var(--text-luxury-light); padding: 0.75rem 1rem; transition: var(--transition-smooth); text-decoration: none;" onmouseover="this.style.background='rgba(212, 175, 55, 0.2)'; this.style.color='var(--luxury-gold)'" onmouseout="this.style.background='transparent'; this.style.color='var(--text-luxury-light)'">
                <i class="fas fa-user-circle mr-2"></i> Profile
              </a>
            </div>
          </div>
          <a href="/logout"><i class="fas fa-sign-out-alt mr-1"></i>Logout</a>
        </div>
      </nav>
    </header>

    <main class="container">
      <div class="dashboard-header">
        <h1 class="dashboard-title">Admin Dashboard</h1>
        <div class="dashboard-actions">
          <a href="/dashboard" class="btn back-btn">Back to Dashboard</a>
          <a href="/owner/dashboard" class="btn back-btn" id="toOwner" style="display: none;">To Owner Dashboard</a>
          <button class="btn btn-secondary" id="refreshBtn">Refresh Data</button>
          <a href="/admin/login-history" class="btn btn-secondary"><i class="fas fa-history mr-1"></i>Login History</a>
          <button class="btn" id="openCreateAdminBtn"><i class="fas fa-user-plus mr-1"></i>Create Admin</button>
        </div>
      </div>

      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="customers">Customers</button>
          <button class="tab-button" data-tab="fleet-managers">Fleet Managers</button>
          <button class="tab-button" data-tab="system-admins">System Administrators</button>
          <button class="tab-button" data-tab="owners">Owners</button>
        </div>

        <div class="tab-content active" id="customers-tab">
          <section class="user-list customer-list">
            <div class="section-header" style="padding: 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
              <h2 class="section-title" style="color: var(--luxury-gold); font-family: var(--font-luxury-primary); font-size: 1.3rem; margin: 0; display: flex; align-items: center;">
                <i class="fas fa-users mr-2"></i>Customer Management
              </h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="customerTableBody">
                <!-- Customer data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="fleet-managers-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">Fleet Manager List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Department</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="fleetManagerTableBody">
                <!-- Fleet manager data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="system-admins-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">System Administrator List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Position</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="systemAdminTableBody">
                <!-- System admin data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>

        <div class="tab-content" id="owners-tab">
          <section class="user-list">
            <div class="section-header">
              <h2 class="section-title">Owner List</h2>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th class="action-cell">Actions</th>
                </tr>
              </thead>
              <tbody id="ownerTableBody">
                <!-- Owner data will be loaded here -->
              </tbody>
            </table>
          </section>
        </div>
      </div>

      <section class="customer-details" id="customerDetails">
        <h3>Customer Details</h3>
        <div class="customer-info">
          <div class="info-item">
            <div class="info-label">First Name</div>
            <div class="info-value" id="firstName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Name</div>
            <div class="info-value" id="lastName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="email"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Contact Number</div>
            <div class="info-value" id="contactNumber"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Street Address</div>
            <div class="info-value" id="street"></div>
          </div>
          <div class="info-item">
            <div class="info-label">City</div>
            <div class="info-value" id="city"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Postal Code</div>
            <div class="info-value" id="postalCode"></div>
          </div>
        </div>
      </section>

      <!-- User Details Section -->
      <section class="customer-details" id="userDetails" style="display: none;">
        <h3>User Details</h3>
        <div class="customer-info">
          <div class="info-item">
            <div class="info-label">First Name</div>
            <div class="info-value" id="userFirstName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Name</div>
            <div class="info-value" id="userLastName"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="userEmail"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Role</div>
            <div class="info-value" id="userRole"></div>
          </div>
          <div class="info-item" id="departmentItem" style="display: none;">
            <div class="info-label">Department</div>
            <div class="info-value" id="userDepartment"></div>
          </div>
          <div class="info-item" id="positionItem" style="display: none;">
            <div class="info-label">Position</div>
            <div class="info-value" id="userPosition"></div>
          </div>
          <div class="info-item" id="employeeIdItem" style="display: none;">
            <div class="info-label">Employee ID</div>
            <div class="info-value" id="userEmployeeId"></div>
          </div>
        </div>
      </section>

      <!-- Delete Confirmation Modal -->
      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Confirm Delete</h3>
          <p>Are you sure you want to delete this customer account? This action cannot be undone.</p>
          <div class="modal-actions">
            <button id="cancelDeleteBtn" class="btn">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>

      <!-- Edit Customer Modal -->
      <div id="editModal" class="modal">
        <div class="modal-content" style="width: 500px; max-width: 95%;">
          <h3 class="modal-title">Edit Customer</h3>
          <form id="editCustomerForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label for="editFirstName">First Name</label>
                <input type="text" id="editFirstName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editLastName">Last Name</label>
                <input type="text" id="editLastName" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="editContactNumber">Phone Number</label>
                <input type="text" id="editContactNumber" class="form-control">
              </div>
              <div class="form-group">
                <label for="editStreet">Street Address</label>
                <input type="text" id="editStreet" class="form-control">
              </div>
              <div class="form-group">
                <label for="editCity">City</label>
                <input type="text" id="editCity" class="form-control">
              </div>
              <div class="form-group">
                <label for="editPostalCode">Postal Code</label>
                <input type="text" id="editPostalCode" class="form-control">
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" id="cancelEditBtn" class="btn">Cancel</button>
              <button type="submit" class="btn btn-secondary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Change Role Modal -->
      <div id="changeRoleModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Change User Role</h3>
          <p>Select a new role for <span id="changeRoleUserName">this user</span>:</p>
          <div class="form-group">
            <label for="roleSelect">Role</label>
            <select id="roleSelect" class="form-control">
              <!-- Roles will be loaded dynamically -->
            </select>
          </div>
          <div class="modal-actions">
            <button id="cancelChangeRoleBtn" class="btn">Cancel</button>
            <button id="confirmChangeRoleBtn" class="btn btn-secondary">Change Role</button>
          </div>
        </div>
      </div>

      <!-- Delete User Confirmation Modal -->
      <div id="deleteUserModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title">Confirm Delete</h3>
          <p>Are you sure you want to delete the account for <span id="deleteUserName">this user</span>? This action cannot be undone.</p>
          <div class="modal-actions">
            <button id="cancelDeleteUserBtn" class="btn">Cancel</button>
            <button id="confirmDeleteUserBtn" class="btn btn-danger">Delete User</button>
          </div>
        </div>
      </div>

      <!-- Create Admin Modal -->
      <div id="createAdminModal" class="modal">
        <div class="modal-content" style="width: 560px; max-width: 95%;">
          <h3 class="modal-title">Create Admin Account</h3>
          <form id="createAdminForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label for="adminFirstName">First Name</label>
                <input type="text" id="adminFirstName" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="adminLastName">Last Name</label>
                <input type="text" id="adminLastName" class="form-control" required />
              </div>
              <div class="form-group" style="grid-column: span 2;">
                <label for="adminEmail">Email</label>
                <input type="email" id="adminEmail" class="form-control" required />
              </div>
              <div class="form-group" style="grid-column: span 2;">
                <label for="adminPassword">Temporary Password</label>
                <input type="password" id="adminPassword" class="form-control" placeholder="Min 6 characters" minlength="6" required />
              </div>
              <div class="form-group" style="grid-column: span 2;">
                <label for="adminRole">Role</label>
                <select id="adminRole" class="form-control" required>
                  <option value="" disabled selected>Select Role</option>
                  <option value="ROLE_FLEET_MANAGER">Fleet Manager</option>
                  <option value="ROLE_SYSTEM_ADMIN">System Administrator</option>
                  <option value="ROLE_OWNER">Owner</option>
                </select>
              </div>
              <div class="form-group" style="grid-column: span 2;">
                <label for="adminStaffId">Staff ID (optional)</label>
                <input type="text" id="adminStaffId" class="form-control" placeholder="Auto-generated if blank" />
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" id="cancelCreateAdminBtn" class="btn">Cancel</button>
              <button type="submit" class="btn btn-secondary">Create</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- Admin notifications removed -->

    <script>

      if(localStorage.getItem("userRole") && localStorage.getItem("userRole").includes("OWNER")){
        $("#toOwner").show();
      }else{
        $("#toOwner").hide();
      }

      document.addEventListener('DOMContentLoaded', function() {
        // Populate Admin profile controls and wire navigation
        try {
          const userName = localStorage.getItem('userName') || 'System Admin';
          const userEmail = localStorage.getItem('userEmail') || 'admin@velorent.com';
          const initials = userName.split(' ').map(n => n.charAt(0)).join('').toUpperCase();
          const nameEl = document.getElementById('admin-user-name');
          const emailEl = document.getElementById('admin-user-email');
          const initialsEl = document.getElementById('admin-user-initials');
          const profileLink = document.getElementById('admin-profile-dropdown-link');
          if (nameEl) nameEl.textContent = userName;
          if (emailEl) emailEl.textContent = userEmail;
          if (profileLink) profileLink.href = `/profile?email=${encodeURIComponent(userEmail)}`;
          if (initialsEl) {
            initialsEl.textContent = initials || 'AD';
            initialsEl.style.cursor = 'pointer';
            const goToProfile = (e) => {
              e.preventDefault();
              e.stopPropagation();
              window.location.href = `/profile?email=${encodeURIComponent(userEmail)}`;
            };
            initialsEl.addEventListener('click', goToProfile);
            const parentBtn = initialsEl.closest('button');
            if (parentBtn) {
              parentBtn.style.cursor = 'pointer';
              if (parentBtn.hasAttribute('data-toggle')) parentBtn.removeAttribute('data-toggle');
              parentBtn.addEventListener('click', goToProfile);
            }
          }
        } catch (e) { /* no-op */ }

        loadCustomers();
        loadFleetManagers();
        loadSystemAdmins();
        loadOwners();
        loadRoles(); // Load available roles for the role changing feature

        // Add event listener for refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
          loadCustomers();
          loadFleetManagers();
          loadSystemAdmins();
          loadOwners();
        });

        // Create Admin modal open/close
        document.getElementById('openCreateAdminBtn').addEventListener('click', function(){
          document.getElementById('createAdminModal').style.display = 'flex';
        });
        document.getElementById('cancelCreateAdminBtn').addEventListener('click', function(){
          document.getElementById('createAdminModal').style.display = 'none';
        });

        // Create admin submit
        document.getElementById('createAdminForm').addEventListener('submit', async function(e){
          e.preventDefault();
          const payload = {
            firstName: document.getElementById('adminFirstName').value.trim(),
            lastName: document.getElementById('adminLastName').value.trim(),
            email: document.getElementById('adminEmail').value.trim(),
            password: document.getElementById('adminPassword').value,
            roleName: document.getElementById('adminRole').value,
            staffIdCode: document.getElementById('adminStaffId').value.trim() || null
          };

          try{
            const res = await fetch('/api/admin/users', {
              method: 'POST',
              credentials: 'include',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            const ok = res.ok;
            const data = await res.json().catch(() => ({}));
            if(!ok || data.success === false){
              throw new Error((data && data.message) || 'Failed to create admin user');
            }
            // Close modal, refresh lists depending on role
            document.getElementById('createAdminModal').style.display = 'none';
            document.getElementById('createAdminForm').reset();
            loadFleetManagers();
            loadSystemAdmins();
            loadOwners();
            alert('Admin account created successfully');
          }catch(err){
            console.error('Create admin failed:', err);
            alert('Failed to create admin: ' + err.message);
          }
        });

        // Modal event listeners
        document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
          document.getElementById('deleteModal').style.display = 'none';
        });

        document.getElementById('cancelEditBtn').addEventListener('click', function() {
          document.getElementById('editModal').style.display = 'none';
        });

        document.getElementById('cancelChangeRoleBtn').addEventListener('click', function() {
          document.getElementById('changeRoleModal').style.display = 'none';
        });

        document.getElementById('confirmChangeRoleBtn').addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          const roleId = document.getElementById('roleSelect').value;
          if (userId && roleId) {
            changeUserRole(userId, roleId);
          }
        });

        // Add event listeners for delete user modal
        document.getElementById('cancelDeleteUserBtn').addEventListener('click', function() {
          document.getElementById('deleteUserModal').style.display = 'none';
        });

        document.getElementById('confirmDeleteUserBtn').addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          if (userId) {
            deleteUser(userId);
          }
        });

        // Tab switching functionality
        document.querySelectorAll('.tab-button').forEach(button => {
          button.addEventListener('click', function() {
            // Remove active class from all buttons and tab contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to clicked button
            this.classList.add('active');

            // Show the corresponding tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId + '-tab').classList.add('active');

            // Hide any open details panels
            document.getElementById('customerDetails').style.display = 'none';
            document.getElementById('userDetails').style.display = 'none';
          });
        });
      });

      // Global variable to store all roles
      let availableRoles = [];

      function loadRoles() {
        fetch('/api/admin/roles', {
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load roles');
          }
          return response.json();
        })
        .then(roles => {
          availableRoles = roles;
        })
        .catch(error => {
          console.error('Error loading roles:', error);
        });
      }

      function createActionButtons(user) {
        const actionCell = document.createElement('td');
        actionCell.classList.add('action-cell');

        // Create action buttons container
        const actionButtons = document.createElement('div');
        actionButtons.classList.add('action-buttons');

        // Create details button
        const detailsButton = document.createElement('button');
        detailsButton.innerHTML = '<i class="fas fa-info-circle"></i>';
        detailsButton.classList.add('btn-action', 'btn-details');
        detailsButton.title = 'View Details';
        detailsButton.onclick = function(e) {
          e.stopPropagation(); // Prevent row click event
          showUserDetails(user.id);
        };

        // Create change role button
        const changeRoleButton = document.createElement('button');
        changeRoleButton.innerHTML = '<i class="fas fa-user-cog"></i>';
        changeRoleButton.classList.add('btn-action', 'btn-role');
        changeRoleButton.title = 'Change Role';
        changeRoleButton.onclick = function(e) {
          e.stopPropagation(); // Prevent row click event
          showChangeRoleModal(user.id, `${user.firstName} ${user.lastName}`, user.role);
        };

        // Create delete button
        const deleteButton = document.createElement('button');
        deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
        deleteButton.classList.add('btn-action', 'btn-delete');
        deleteButton.title = 'Delete User';
        deleteButton.onclick = function(e) {
          e.stopPropagation(); // Prevent row click event
          showDeleteConfirmModal(user.id, `${user.firstName} ${user.lastName}`);
        };

        actionButtons.appendChild(detailsButton);
        actionButtons.appendChild(changeRoleButton);
        actionButtons.appendChild(deleteButton);
        actionCell.appendChild(actionButtons);

        return actionCell;
      }

      function showChangeRoleModal(userId, userName, currentRole) {
        // Set user name in the modal
        document.getElementById('changeRoleUserName').textContent = userName;

        // Populate role dropdown
        const roleSelect = document.getElementById('roleSelect');
        roleSelect.innerHTML = '';

        if (availableRoles.length === 0) {
          // If roles haven't been loaded yet, load them now
          fetch('/api/admin/roles', {
            credentials: 'include'
          })
          .then(response => response.json())
          .then(roles => {
            availableRoles = roles;
            populateRoleDropdown(roleSelect, currentRole);
          });
        } else {
          populateRoleDropdown(roleSelect, currentRole);
        }

        // Set user ID on the confirm button
        document.getElementById('confirmChangeRoleBtn').setAttribute('data-user-id', userId);

  // Show the modal (centered)
  document.getElementById('changeRoleModal').style.display = 'flex';
      }

      function populateRoleDropdown(selectElement, currentRole) {
        availableRoles.forEach(role => {
          const option = document.createElement('option');
          option.value = role.id;
          option.textContent = role.name.replace('ROLE_', '');

          // Select the current role
          if (role.name === currentRole) {
            option.selected = true;
          }

          selectElement.appendChild(option);
        });
      }

      function changeUserRole(userId, roleId) {
        fetch(`/api/admin/users/${userId}/role`, {
          method: 'PUT',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ roleId: parseInt(roleId) })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update user role');
          }
          return response.json();
        })
        .then(updatedUser => {
          // Hide the modal
          document.getElementById('changeRoleModal').style.display = 'none';

          // Reload all user lists to reflect the change
          loadCustomers();
          loadFleetManagers();
          loadSystemAdmins();
          loadOwners();

          // Show success message
          alert('User role updated successfully');

          // Update user details if currently shown
          if (document.getElementById('userDetails').style.display === 'block') {
            showUserDetails(userId);
          }
        })
        .catch(error => {
          console.error('Error updating user role:', error);
          alert('Failed to update user role. Please try again later.');
        });
      }

      function loadCustomers() {
        fetch('/api/admin/customers', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customers');
            }
            return response.json();
          })
          .then(customers => {
            const tableBody = document.getElementById('customerTableBody');
            tableBody.innerHTML = '';

            customers.forEach(customer => {
              const row = document.createElement('tr');

              // Create cells for customer info
              const idCell = document.createElement('td');
              idCell.textContent = customer.id;
              idCell.classList.add('user-id-cell');

              const nameCell = document.createElement('td');
              nameCell.textContent = `${customer.firstName} ${customer.lastName}`;
              nameCell.classList.add('user-name-cell');

              const emailCell = document.createElement('td');
              emailCell.textContent = customer.email;
              emailCell.classList.add('user-email-cell');

              const actionCell = document.createElement('td');
              actionCell.classList.add('action-cell');

              // Create action buttons container
              const actionButtons = document.createElement('div');
              actionButtons.classList.add('action-buttons');

              // Create edit button
              const editButton = document.createElement('button');
              editButton.innerHTML = '<i class="fas fa-edit"></i>';
              editButton.classList.add('btn-action', 'btn-edit');
              editButton.title = 'Edit Customer';
              editButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showEditForm(customer.id);
              };

              // Create delete button
              const deleteButton = document.createElement('button');
              deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
              deleteButton.classList.add('btn-action', 'btn-delete');
              deleteButton.title = 'Delete Customer';
              deleteButton.onclick = function(e) {
                e.stopPropagation(); // Prevent row click event
                showDeleteConfirmation(customer.id);
              };

              actionButtons.appendChild(editButton);
              actionButtons.appendChild(deleteButton);
              actionCell.appendChild(actionButtons);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(actionCell);

              // Add click event to show customer details (exclude action cell)
              nameCell.addEventListener('click', () => showCustomerDetails(customer.id));
              idCell.addEventListener('click', () => showCustomerDetails(customer.id));
              emailCell.addEventListener('click', () => showCustomerDetails(customer.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading customers:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function loadFleetManagers() {
        fetch('/api/admin/users/fleet-managers', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load fleet managers');
            }
            return response.json();
          })
          .then(fleetManagers => {
            const tableBody = document.getElementById('fleetManagerTableBody');
            tableBody.innerHTML = '';

            fleetManagers.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;
              idCell.classList.add('user-id-cell');

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;
              nameCell.classList.add('user-name-cell');

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;
              emailCell.classList.add('user-email-cell');

              const deptCell = document.createElement('td');
              deptCell.textContent = user.staffIdCode || 'N/A';
              deptCell.classList.add('user-role-cell');

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(deptCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading fleet managers:', error);
            alert('Failed to load fleet manager data. Please try again later.');
          });
      }

      function loadSystemAdmins() {
        fetch('/api/admin/users/system-admins', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load system admins');
            }
            return response.json();
          })
          .then(systemAdmins => {
            const tableBody = document.getElementById('systemAdminTableBody');
            tableBody.innerHTML = '';

            systemAdmins.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;

              const positionCell = document.createElement('td');
              positionCell.textContent = user.staffIdCode || 'N/A';

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(positionCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading system admins:', error);
            alert('Failed to load system admin data. Please try again later.');
          });
      }

      function loadOwners() {
        fetch('/api/admin/users/owners', {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load owners');
            }
            return response.json();
          })
          .then(owners => {
            const tableBody = document.getElementById('ownerTableBody');
            tableBody.innerHTML = '';

            owners.forEach(user => {
              const row = document.createElement('tr');

              // Create cells for user info
              const idCell = document.createElement('td');
              idCell.textContent = user.id;

              const nameCell = document.createElement('td');
              nameCell.textContent = `${user.firstName} ${user.lastName}`;

              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;

              // Create action buttons
              const actionCell = createActionButtons(user);

              // Add cells to row
              row.appendChild(idCell);
              row.appendChild(nameCell);
              row.appendChild(emailCell);
              row.appendChild(actionCell);

              // Add click event to show user details
              row.addEventListener('click', () => showUserDetails(user.id));

              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error loading owners:', error);
            alert('Failed to load owner data. Please try again later.');
          });
      }

      function showUserDetails(userId) {
        fetch(`/api/admin/users/${userId}`, {
          credentials: 'include'
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load user details');
            }
            return response.json();
          })
          .then(user => {
            // Hide customer details if showing
            document.getElementById('customerDetails').style.display = 'none';

            // Populate user details
            document.getElementById('userFirstName').textContent = user.firstName || 'N/A';
            document.getElementById('userLastName').textContent = user.lastName || 'N/A';
            document.getElementById('userEmail').textContent = user.email || 'N/A';
            document.getElementById('userRole').textContent = user.role || 'N/A';

            // Handle staff-specific fields
            const departmentItem = document.getElementById('departmentItem');
            const positionItem = document.getElementById('positionItem');
            const employeeIdItem = document.getElementById('employeeIdItem');

            if (user.department) {
              document.getElementById('userDepartment').textContent = user.department;
              departmentItem.style.display = 'block';
            } else {
              departmentItem.style.display = 'none';
            }

            if (user.position) {
              document.getElementById('userPosition').textContent = user.position;
              positionItem.style.display = 'block';
            } else {
              positionItem.style.display = 'none';
            }

            if (user.employeeId) {
              document.getElementById('userEmployeeId').textContent = user.employeeId;
              employeeIdItem.style.display = 'block';
            } else {
              employeeIdItem.style.display = 'none';
            }

            // Show the details section
            document.getElementById('userDetails').style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading user details:', error);
            alert('Failed to load user details. Please try again later.');
          });
      }

      function showCustomerDetails(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer details');
            }
            return response.json();
          })
          .then(customer => {
            // Populate customer details
            document.getElementById('firstName').textContent = customer.firstName || 'N/A';
            document.getElementById('lastName').textContent = customer.lastName || 'N/A';
            document.getElementById('email').textContent = customer.email || 'N/A';
            document.getElementById('contactNumber').textContent = customer.contactNumber || 'N/A';
            document.getElementById('street').textContent = customer.addressStreet || 'N/A';
            document.getElementById('city').textContent = customer.addressCity || 'N/A';
            document.getElementById('postalCode').textContent = customer.addressPostalCode || 'N/A';

            // Show the details section
            document.getElementById('customerDetails').style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading customer details:', error);
            alert('Failed to load customer details. Please try again later.');
          });
      }

      function showDeleteConfirmation(customerId) {
        // Store the customer ID in the confirm button's data attribute
        document.getElementById('confirmDeleteBtn').setAttribute('data-customer-id', customerId);

  // Display the modal (centered)
  document.getElementById('deleteModal').style.display = 'flex';

        // Set up the confirm delete button
        document.getElementById('confirmDeleteBtn').onclick = function() {
          deleteCustomer(customerId);
        };
      }

      function deleteCustomer(customerId) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'DELETE',
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to delete customer');
          }
          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Hide customer details if currently shown
          document.getElementById('customerDetails').style.display = 'none';

          // Show success message
          alert('Customer deleted successfully');
        })
        .catch(error => {
          console.error('Error deleting customer:', error);
          alert('Failed to delete customer. Please try again later.');

          // Hide the modal
          document.getElementById('deleteModal').style.display = 'none';
        });
      }

      function showEditForm(customerId) {
        // Fetch customer data and populate the edit form
        fetch(`/api/admin/customers/${customerId}`, {
          credentials: 'include' // Include credentials (cookies) with the request
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to load customer data for editing');
            }
            return response.json();
          })
          .then(customer => {
            // Populate the form fields with customer data
            document.getElementById('editFirstName').value = customer.firstName || '';
            document.getElementById('editLastName').value = customer.lastName || '';
            document.getElementById('editEmail').value = customer.email || '';
            document.getElementById('editContactNumber').value = customer.contactNumber || '';
            document.getElementById('editStreet').value = customer.addressStreet || '';
            document.getElementById('editCity').value = customer.addressCity || '';
            document.getElementById('editPostalCode').value = customer.addressPostalCode || '';

            // Display the edit modal (centered with flex)
            const editModalEl = document.getElementById('editModal');
            editModalEl.style.display = 'flex';

            // Handle form submission
            const form = document.getElementById('editCustomerForm');
            form.onsubmit = function(e) {
              e.preventDefault(); // Prevent default form submission

              // Gather updated customer data from the form
              const updatedCustomer = {
                firstName: document.getElementById('editFirstName').value,
                lastName: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                contactNumber: document.getElementById('editContactNumber').value,
                addressStreet: document.getElementById('editStreet').value,
                addressCity: document.getElementById('editCity').value,
                addressPostalCode: document.getElementById('editPostalCode').value
              };

              // Send the updated data to the server
              updateCustomer(customerId, updatedCustomer);
            };
          })
          .catch(error => {
            console.error('Error loading customer data for editing:', error);
            alert('Failed to load customer data. Please try again later.');
          });
      }

      function updateCustomer(customerId, customerData) {
        fetch(`/api/admin/customers/${customerId}`, {
          method: 'PUT',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(customerData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update customer data');
          }
          return response.json();
        })
        .then(data => {
          // Hide the modal
          document.getElementById('editModal').style.display = 'none';

          // Reload customer list
          loadCustomers();

          // Update customer details if currently shown
          if (document.getElementById('customerDetails').style.display === 'block') {
            showCustomerDetails(customerId);
          }

          // Show success message
          alert('Customer data updated successfully');
        })
        .catch(error => {
          console.error('Error updating customer data:', error);
          alert('Failed to update customer data. Please try again later.');
        });
      }

      // Functions for admin user deletion
      function showDeleteConfirmModal(userId, userName) {
        // Set user name in the modal
        document.getElementById('deleteUserName').textContent = userName;

        // Set user ID on the confirm button
        document.getElementById('confirmDeleteUserBtn').setAttribute('data-user-id', userId);

  // Show the modal (centered)
  document.getElementById('deleteUserModal').style.display = 'flex';
      }

      function deleteUser(userId) {
        fetch(`/api/admin/users/${userId}`, {
          method: 'DELETE',
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to delete user');
          }
          // Hide the modal
          document.getElementById('deleteUserModal').style.display = 'none';

          // Reload all user lists to reflect the change
          loadFleetManagers();
          loadSystemAdmins();
          loadOwners();

          // Hide user details if currently shown
          document.getElementById('userDetails').style.display = 'none';

          // Show success message
          alert('User deleted successfully');
        })
        .catch(error => {
          console.error('Error deleting user:', error);
          alert('Failed to delete user. Please try again later.');

          // Hide the modal
          document.getElementById('deleteUserModal').style.display = 'none';
        });
      }
    </script>

    <script>
      // Generic UX: close modals on overlay click or ESC key
      (function(){
        const modals = ['deleteModal','editModal','changeRoleModal','deleteUserModal','createAdminModal'];
        modals.forEach(id => {
          const el = document.getElementById(id);
          if(!el) return;
          el.addEventListener('click', (e) => {
            if (e.target === el) {
              el.style.display = 'none';
            }
          });
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            modals.forEach(id => {
              const el = document.getElementById(id);
              if(el && getComputedStyle(el).display !== 'none'){
                el.style.display = 'none';
              }
            });
          }
        });
      })();
    </script>

    <!-- Luxury Theme JavaScript -->
    <script src="/js/luxury-theme.js"></script>
    <script src="/js/luxury-theme-enhancer.js"></script>
  </body>
</html>
