<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | VeloRent - Luxury Car Rental</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="/css/DataTables/datatables.min.css" />
    <!-- Luxury Theme CSS -->
    <link rel="stylesheet" href="/css/luxury-theme.css" />
    <style>
      /* Luxury Dashboard Enhancements */
      body {
        padding-top: 80px; /* Account for fixed navbar */
      }
      
      /* Dashboard specific luxury styling */
      .dashboard-wrapper {
        overflow-x: hidden;
      }
      
      .dashboard-container {
        min-height: 100vh;
        background: var(--gradient-luxury);
      }
      
      /* Enhanced Navigation Styling */
      .navbar-luxury {
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 50%, var(--luxury-black) 100%) !important;
        border-bottom: 2px solid var(--luxury-gold);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        padding: 1rem 0;
      }

      .navbar-brand-luxury {
        font-size: 1.8rem !important;
        font-weight: 700 !important;
        color: var(--luxury-gold) !important;
        font-family: var(--font-luxury-primary) !important;
        text-decoration: none !important;
        display: flex;
        align-items: center;
        transition: var(--transition-smooth);
      }

      .navbar-brand-luxury:hover {
        color: var(--luxury-gold) !important;
        transform: scale(1.05);
        text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
      }

      .nav-link-luxury {
        color: var(--text-luxury-light) !important;
        font-weight: 600 !important;
        padding: 12px 20px !important;
        margin: 0 5px !important;
        border-radius: var(--radius-luxury-small) !important;
        transition: var(--transition-smooth) !important;
        text-decoration: none !important;
        border: 1px solid transparent !important;
        font-size: 0.95rem !important;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        cursor: pointer;
        pointer-events: auto;
        position: relative;
        z-index: 1000;
      }

      .nav-link-luxury:hover {
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 100%) !important;
        color: var(--luxury-gold) !important;
        border-color: var(--luxury-gold) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      }

      .auth-buttons {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .btn-luxury {
        background: var(--gradient-gold) !important;
        color: var(--luxury-black) !important;
        border: none !important;
        padding: 10px 20px !important;
        border-radius: var(--radius-luxury-small) !important;
        font-weight: 600 !important;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: var(--transition-smooth) !important;
        font-size: 0.9rem !important;
      }

      .btn-luxury:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%) !important;
        color: var(--luxury-black) !important;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      }

      .btn-luxury-outline {
        background: transparent !important;
        color: var(--luxury-gold) !important;
        border: 2px solid var(--luxury-gold) !important;
      }

      .btn-luxury-outline:hover {
        background: var(--gradient-gold) !important;
        color: var(--luxury-black) !important;
      }
      
      /* Stats cards enhancement */
      .stats-card {
        background: var(--luxury-charcoal);
        border: 1px solid rgba(212, 175, 55, 0.2);
        border-radius: var(--radius-luxury-large);
        padding: 2rem;
        text-align: center;
        transition: var(--transition-smooth);
        position: relative;
        overflow: hidden;
      }
      
      .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--gradient-gold);
      }
      
      .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-luxury);
        border-color: var(--luxury-gold);
      }

      /* Profile dropdown styles */
      .profile-dropdown {
        position: relative;
        display: inline-block;
      }

      .profile-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--secondary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: bold;
        margin-left: 10px;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: var(--card-background);
        min-width: 220px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        z-index: 1;
      }

      .dropdown-content a {
        color: var(--text-color);
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        border-bottom: 1px solid var(--border-color);
      }

      .dropdown-content a:last-child {
        border-bottom: none;
      }

      .dropdown-content a:hover {
        background-color: var(--background-color);
      }

      .profile-dropdown:hover .dropdown-content {
        display: block;
      }

      .profile-info {
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        text-align: center;
      }

      .profile-info .user-email {
        font-size: 13px;
        color: var(--light-text);
        margin-top: 5px;
      }

      main {
        margin-top: 30px;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 25px 0;
        border-bottom: 2px solid rgba(212, 175, 55, 0.2);
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, transparent 100%);
        border-radius: var(--radius-luxury-large) var(--radius-luxury-large) 0 0;
      }

      .dashboard-title {
        font-size: 2.5rem;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        position: relative;
        display: flex;
        align-items: center;
      }

      .dashboard-title::before {
        content: '\f3fd';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        margin-right: 20px;
        font-size: 2rem;
        background: var(--gradient-gold);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .dashboard-actions {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .btn {
        background: var(--gradient-gold);
        color: var(--luxury-black);
        border: none;
        padding: 12px 24px;
        border-radius: var(--radius-luxury-small);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: var(--transition-smooth);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      }

      .btn-accent {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
      }

      .btn-accent:hover {
        background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
        box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      .btn i {
        margin-right: 8px;
        font-size: 1em;
      }

      .dashboard-content {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
      }

      .welcome-message {
        font-size: 18px;
        margin-bottom: 20px;
      }

      .message {
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .message.error {
        background-color: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
        border: 1px solid rgba(231, 76, 60, 0.3);
      }

      .message.success {
        background-color: rgba(46, 204, 113, 0.1);
        color: #27ae60;
        border: 1px solid rgba(46, 204, 113, 0.3);
      }

      /* Enhanced Footer */
      footer {
        margin-top: 60px;
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 50%, var(--luxury-black) 100%);
        color: var(--text-luxury-light);
        font-size: 1rem;
        padding: 40px 0;
        border-top: 2px solid var(--luxury-gold);
        position: relative;
        overflow: hidden;
      }

      footer::before {
        content: '';
        position: absolute;
        top: -2px;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 2px;
        background: var(--gradient-gold);
        border-radius: 2px;
      }

      footer p {
        margin: 0;
        font-weight: 500;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      footer p::before {
        content: '\f3fd';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        color: var(--luxury-gold);
        font-size: 1.2em;
      }

      footer p::after {
        content: '\f3fd';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        color: var(--luxury-gold);
        font-size: 1.2em;
      }

      .footer-content {
        text-align: center;
        position: relative;
        z-index: 2;
      }

      .footer-year {
        color: var(--luxury-gold);
        font-weight: 700;
      }

      .footer-brand {
        background: var(--gradient-gold);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        font-family: var(--font-luxury-primary);
      }

      /* Vehicle Management Styles */
      #fleet-manager-content {
        display: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background-color: var(--background-color);
        font-weight: 500;
        color: var(--primary-color);
      }

      tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .search-bar {
        margin-bottom: 20px;
        width: 100%;
        max-width: 300px;
      }

      .form-control {
        width: 100%;
        padding: 10px;
        font-size: 14px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
      }

      .form-control:focus {
        border-color: var(--secondary-color);
        outline: none;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        animation: modalFadeIn 0.3s ease-out;
      }

      /* Modal Z-Index Hierarchy */
      #package-details-modal {
        z-index: 150;
      }

      #vehicle-details-modal {
        z-index: 200;
        background-color: rgba(0, 0, 0, 0.85);
      }

      #booking-modal {
        z-index: 250;
        background-color: rgba(0, 0, 0, 0.9);
      }

      #package-booking-modal {
        z-index: 250;
        background-color: rgba(0, 0, 0, 0.9);
      }

      #payment-modal {
        z-index: 300;
        background-color: rgba(0, 0, 0, 0.95);
      }

      /* Enhanced backdrop blur for higher z-index modals */
      #vehicle-details-modal {
        backdrop-filter: blur(8px);
      }

      #booking-modal, #package-booking-modal {
        backdrop-filter: blur(10px);
      }

      #payment-modal {
        backdrop-filter: blur(12px);
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          backdrop-filter: blur(0px);
        }
        to {
          opacity: 1;
          backdrop-filter: blur(5px);
        }
      }

      @keyframes modalSlideIn {
        from {
          transform: translateY(-50px) scale(0.9);
          opacity: 0;
        }
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      .modal-content {
        background-color: var(--card-background);
        margin: 5% auto;
        padding: 20px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        animation: modalSlideIn 0.4s ease-out;
        transform-origin: center top;
      }

      /* Vehicle Modal Specific Styles */
      #vehicle-details-modal .modal-content {
        animation: modalSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      #vehicle-details-modal .modal-content:hover .vehicle-details-image img {
        transform: scale(1.02);
      }

      #vehicle-details-modal .close:hover {
        transform: rotate(90deg);
        color: #ff6b6b;
      }

      /* Button Hover Effects for Vehicle Modal */
      #vehicle-details-modal .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      #vehicle-details-modal .btn-accent:hover {
        background: linear-gradient(135deg, var(--luxury-gold) 0%, #f1c40f 100%);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
      }

      /* Responsive Design for Vehicle Modal */
      @media (max-width: 768px) {
        #vehicle-details-modal .modal-content {
          margin: 2% auto;
          width: 95%;
          max-width: none;
          padding: 15px;
        }
        
        #vehicle-details-modal .vehicle-details-container {
          grid-template-columns: 1fr !important;
          gap: 25px !important;
        }
        
        #vehicle-details-modal .modal-header {
          padding: 20px 15px !important;
          margin: -15px -15px 0 -15px !important;
        }
        
        #vehicle-details-modal .modal-title {
          font-size: 20px !important;
        }
        
        #vehicle-details-modal .vehicle-details-info > div {
          padding: 20px !important;
        }
        
        #vehicle-details-modal .form-actions {
          flex-direction: column;
          gap: 10px !important;
        }
        
        #vehicle-details-modal .btn {
          width: 100%;
          min-width: auto !important;
        }
      }

      @media (max-width: 480px) {
        #vehicle-details-modal .vehicle-details-info > div > div {
          grid-template-columns: 1fr !important;
        }
        
        #vehicle-details-modal .modal-header div:first-child {
          gap: 10px !important;
        }
        
        #vehicle-details-modal .modal-header div:first-child > div:first-child {
          width: 40px !important;
          height: 40px !important;
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .modal-title {
        font-size: 18px;
        font-weight: 500;
      }

      .close {
        color: var(--light-text);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: var(--text-color);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: var(--light-text);
      }

      .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .loading {
        display: flex;
        justify-content: center;
        padding: 20px;
      }

      #regular-dashboard-content {
        display: block;
      }

      /* Enhanced Full-Width Vehicles Section */
      .vehicles-section {
        margin: 0;
        padding: 60px 40px;
        background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(45, 45, 45, 0.95) 100%);
        position: relative;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
        min-height: 100vh;
      }

      .vehicles-section::before {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.1;
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20 20h60v60H20z" fill="none" stroke="%23d4af37" stroke-width="0.5"/></svg>');
        background-size: 50px 50px;
      }

      .vehicles-section h3 {
        color: var(--luxury-gold) !important;
        font-family: var(--font-luxury-primary) !important;
        font-size: 2.2rem !important;
        font-weight: 700 !important;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 30px !important;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .vehicles-section h3::before {
        content: 'ðŸš—';
        font-size: 2.5rem;
        margin-right: 20px;
        filter: drop-shadow(2px 2px 5px rgba(0, 0, 0, 0.5));
      }

      .vehicles-section h3::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 3px;
        background: var(--gradient-gold);
        border-radius: 2px;
      }

      .vehicles-controls {
        max-width: 800px;
        margin: 0 auto 40px auto;
      }
      
      .search-bar {
        position: relative;
      }
      
      .sort-controls label {
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .filter-group {
        position: relative;
        z-index: 5;
      }
      
      .filter-group label {
        pointer-events: none;
        user-select: none;
      }
      
      .sort-controls select {
        background: var(--luxury-charcoal) !important;
        border: 2px solid rgba(212, 175, 55, 0.3) !important;
        color: var(--text-luxury-light) !important;
        padding: 12px 15px !important;
        border-radius: var(--radius-luxury-medium) !important;
        font-size: 0.95rem !important;
        transition: var(--transition-smooth) !important;
      }
      
      .sort-controls select:focus {
        border-color: var(--luxury-gold) !important;
        outline: none !important;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.2) !important;
      }

      .search-bar::before {
        content: '\f002';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--luxury-gold);
        z-index: 2;
        font-size: 1.2rem;
      }

      .form-control {
        background: var(--luxury-charcoal) !important;
        border: 2px solid rgba(212, 175, 55, 0.3) !important;
        color: var(--text-luxury-light) !important;
        padding: 18px 20px 18px 55px !important;
        border-radius: var(--radius-luxury-large) !important;
        font-size: 1.1rem !important;
        transition: var(--transition-smooth) !important;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .form-control:focus {
        border-color: var(--luxury-gold) !important;
        outline: none !important;
        box-shadow: 0 0 30px rgba(212, 175, 55, 0.3) !important;
        background: var(--luxury-black) !important;
        transform: translateY(-2px);
      }

      .form-control::placeholder {
        color: var(--text-luxury-muted) !important;
        font-weight: 500;
      }

      /* Filter dropdown specific styling */
      .filter-group select.form-control {
        cursor: pointer !important;
        position: relative !important;
        z-index: 100 !important;
        pointer-events: auto !important;
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        background-image: url('data:image/svg+xml;charset=US-ASCII,<svg viewBox="0 0 4 5" xmlns="http://www.w3.org/2000/svg"><path fill="%23d4af37" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>') !important;
        background-repeat: no-repeat !important;
        background-position: right 12px center !important;
        background-size: 12px !important;
        padding: 18px 40px 18px 20px !important;
      }

      .filter-group select.form-control:hover {
        border-color: var(--luxury-gold) !important;
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.2) !important;
      }

      .filter-group select.form-control option {
        background: var(--luxury-charcoal) !important;
        color: var(--text-luxury-light) !important;
        padding: 10px !important;
      }

      .filter-group {
        position: relative !important;
        z-index: 10 !important;
      }

      .advanced-filters {
        position: relative !important;
        z-index: 50 !important;
      }
      
      /* Enhanced Full-Screen Vehicles Grid */
      .vehicles-grid, .vehicles-grid-enhanced {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 30px;
        margin-top: 40px;
        position: relative;
        z-index: 2;
        width: 100%;
      }
      
      @media (min-width: 1600px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
          gap: 35px;
        }
      }
      
      @media (max-width: 1200px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 25px;
        }
      }
      
      @media (max-width: 768px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 20px;
        }
      }
      
      @media (max-width: 480px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: 1fr;
          gap: 20px;
        }
      }

      .vehicle-card {
        background: linear-gradient(135deg, var(--luxury-charcoal) 0%, var(--luxury-black) 100%);
        border-radius: var(--radius-luxury-large);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        padding: 25px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        border: 2px solid rgba(212, 175, 55, 0.3);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(15px);
        min-height: 450px;
        max-width: 400px;
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transform-style: preserve-3d;
      }

      .vehicle-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-gold);
      }

      .vehicle-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, transparent 50%, rgba(212, 175, 55, 0.05) 100%);
        opacity: 0;
        transition: var(--transition-smooth);
      }

      .vehicle-card:hover {
        transform: translateY(-15px) scale(1.05);
        box-shadow: 0 25px 80px rgba(212, 175, 55, 0.4);
        border-color: var(--luxury-gold);
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), var(--luxury-charcoal) 50%, var(--luxury-black) 100%);
      }

      .vehicle-card:hover::after {
        opacity: 1;
      }
      
      .vehicle-card .vehicle-info {
        position: relative;
        z-index: 5;
      }

      .vehicle-image {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-radius: var(--radius-luxury-medium);
        margin-bottom: 20px;
        border: 2px solid rgba(212, 175, 55, 0.4);
        transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        position: relative;
        z-index: 2;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      .vehicle-card:hover .vehicle-image {
        border-color: var(--luxury-gold);
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
      }

      .vehicle-info {
        font-size: 1rem;
        color: var(--text-luxury-light);
        margin-bottom: 15px;
      }

      .vehicle-info .vehicle-make-model {
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--luxury-gold);
        font-size: 1.3rem;
        font-family: var(--font-luxury-primary);
      }

      .vehicle-info .vehicle-year {
        color: var(--text-luxury-muted);
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 8px;
      }

      .vehicle-price {
        font-size: 1.4rem;
        font-weight: 700;
        margin: 15px 0;
        color: var(--luxury-gold);
        font-family: var(--font-luxury-primary);
      }

      .vehicle-status {
        font-size: 0.95rem;
        margin-bottom: 15px;
        padding: 5px 12px;
      }

      /* Enhanced button styling */
      .view-details-btn {
        transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
      }

      .view-details-btn:hover {
        background: linear-gradient(135deg, #f1c40f, var(--luxury-gold)) !important;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5) !important;
        letter-spacing: 1px;
      }

      /* Full-screen layout adjustments */
      @media (max-width: 768px) {
        .vehicles-section {
          padding: 40px 20px;
        }
        
        .vehicle-card {
          min-height: 400px;
          padding: 20px;
          max-width: none;
        }
        
        .vehicle-image {
          height: 180px;
        }
      }

      @media (max-width: 480px) {
        .vehicles-section {
          padding: 30px 15px;
        }
        
        .advanced-filters {
          padding: 20px !important;
        }
        
        .filter-grid {
          grid-template-columns: 1fr !important;
          gap: 15px !important;
        }
      }

      /* Status badge styling */
      .vehicle-status-badge {
        border-radius: var(--radius-luxury-small);
        display: inline-block;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(46, 204, 113, 0.1) 100%);
        color: #27ae60;
        border: 1px solid rgba(46, 204, 113, 0.3);
      }

      /* Full-screen vehicles container */
      .vehicles-container {
        width: 100%;
        max-width: none;
      }

      /* Remove any container constraints */
      body.dashboard-page {
        overflow-x: hidden;
      }

      /* Ensure proper spacing for large screens */
      @media (min-width: 1920px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
          gap: 40px;
        }
        
        .vehicles-section {
          padding: 80px 60px;
        }
      }

      /* Ultra-wide screen support */
      @media (min-width: 2560px) {
        .vehicles-grid, .vehicles-grid-enhanced {
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 50px;
        }
      }

      .view-details-btn {
        background: var(--gradient-gold);
        color: var(--luxury-black);
        border: none;
        padding: 12px 25px;
        border-radius: var(--radius-luxury-small);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: var(--transition-smooth);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        z-index: 10;
        pointer-events: auto;
        width: 100%;
        margin-top: 10px;
      }

      .view-details-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .view-details-btn:hover::before {
        left: 100%;
      }

      .view-details-btn:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      }

      .view-details-btn i {
        margin-right: 8px;
      }

      /* Loading states */
      .loading {
        text-align: center;
        padding: 40px;
        color: var(--text-luxury-muted);
        font-size: 1.1rem;
      }

      /* Full-Screen Packages Section */
      .packages-section {
        margin: -30px -15px 40px -15px;
        position: relative;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
      }

      .packages-section h3 {
        position: absolute;
        top: 30px;
        left: 50px;
        z-index: 15;
        color: var(--luxury-gold) !important;
        font-family: var(--font-luxury-primary) !important;
        font-size: 3rem !important;
        font-weight: 700 !important;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin: 0 !important;
        text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
      }

      .packages-section h3::before {
        content: 'ðŸŽ‰';
        font-size: 2.5rem;
        margin-right: 20px;
        filter: drop-shadow(2px 2px 5px rgba(0, 0, 0, 0.8));
      }
      
      .packages-slider {
        position: relative;
        overflow: hidden;
        height: 60vh;
        min-height: 500px;
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 100%);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      }
      
      .packages-track {
        display: flex;
        height: 100%;
        transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
      }
      
      .package-slide {
        min-width: 100%;
        height: 100%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      .package-slide::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, 
          rgba(0, 0, 0, 0.7) 0%, 
          rgba(0, 0, 0, 0.4) 50%, 
          rgba(0, 0, 0, 0.7) 100%);
        z-index: 1;
      }
      
      .package-content {
        position: relative;
        z-index: 2;
        text-align: center;
        color: white;
        max-width: 800px;
        padding: 40px;
      }

      .package-image {
        display: none; /* Hidden as we use background image */
      }
      
      .package-info h4 {
        margin-bottom: 20px;
        color: var(--luxury-gold) !important;
        font-family: var(--font-luxury-primary) !important;
        font-size: 4rem !important;
        font-weight: 700;
        text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.8);
        line-height: 1.2;
      }
      
      .package-meta {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.5rem !important;
        margin-bottom: 15px;
        font-weight: 500;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
      }

      .package-meta strong {
        color: var(--luxury-gold);
        font-weight: 700;
        font-size: 1.8rem;
      }
      
      .package-actions {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 30px;
      }

      .package-actions .btn {
        padding: 15px 35px;
        font-size: 1.1rem;
        min-width: 160px;
        justify-content: center;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 2px solid transparent;
      }

      .package-actions .view-details-btn {
        background: transparent;
        color: white;
        border-color: rgba(255, 255, 255, 0.5);
      }

      .package-actions .view-details-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: white;
        color: var(--luxury-gold);
      }
      
      .packages-nav {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 10;
      }
      
      .packages-nav button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: auto;
        background: linear-gradient(135deg, var(--luxury-gold) 0%, #d4af37 100%);
        color: var(--luxury-black);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.3rem;
        font-weight: 700;
        transition: var(--transition-smooth);
        box-shadow: 0 6px 25px rgba(212, 175, 55, 0.4);
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .packages-nav button:hover {
        background: linear-gradient(135deg, #f4d03f 0%, var(--luxury-gold) 100%);
        transform: translateY(-50%) scale(1.15);
        box-shadow: 0 8px 35px rgba(212, 175, 55, 0.6);
      }
      
      .packages-nav .prev { left: 30px; }
      .packages-nav .next { right: 30px; }

      /* Package Indicators */
      .packages-indicators {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 12px;
        z-index: 10;
      }

      .package-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: var(--transition-smooth);
      }

      .package-indicator.active {
        background: var(--luxury-gold);
        transform: scale(1.3);
      }
      
      .packages-empty {
        padding: 100px 40px;
        color: var(--text-luxury-muted);
        text-align: center;
        font-size: 1.5rem;
        background: linear-gradient(135deg, var(--luxury-black) 0%, var(--luxury-charcoal) 100%);
      }

      /* Partially Reserved Package Styling */
      .package-slide.partially-reserved {
        position: relative;
      }

      .package-slide.partially-reserved::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1;
        pointer-events: none;
      }

      .package-slide.partially-reserved .package-content {
        position: relative;
        z-index: 3;
      }

      /* Ensure buttons in partially reserved packages are clickable */
      .package-slide.partially-reserved .package-actions {
        position: relative;
        z-index: 4;
      }

      .package-slide.partially-reserved .package-actions .btn {
        position: relative;
        z-index: 5;
      }

      .availability-notice {
        background: rgba(255, 193, 7, 0.95);
        color: #000;
        padding: 8px 12px;
        border-radius: 8px;
        margin-top: 12px;
        font-size: 11px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 3px 10px rgba(255, 193, 7, 0.4);
        border: 1px solid rgba(255, 193, 7, 0.8);
        text-align: left;
        line-height: 1.3;
      }

      .availability-notice i {
        font-size: 14px;
      }

      .btn-disabled {
        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%) !important;
        border-color: #6c757d !important;
        color: #ffffff !important;
        cursor: not-allowed !important;
        opacity: 0.8 !important;
        font-size: 11px !important;
        padding: 8px 12px !important;
        font-weight: 600 !important;
      }

      .btn-disabled:hover {
        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%) !important;
        border-color: #6c757d !important;
        transform: none !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
      }

      /* Notifications dropdown styles */
      .notifications-toggle{position:relative;background:transparent!important;color:var(--luxury-gold)!important;border:2px solid var(--luxury-gold)!important;border-radius:var(--radius-luxury-small);display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px}
      .notifications-badge{position:absolute;top:-6px;right:-6px;background:#e74c3c;color:#fff;border-radius:50%;font-size:11px;line-height:1;padding:4px 6px;min-width:20px;text-align:center;border:2px solid var(--luxury-black)}
      .notifications-menu{min-width:360px;max-height:420px;overflow-y:auto;background:var(--luxury-dark);border:1px solid rgba(212,175,55,.2)}
      .notif-item{display:flex;gap:10px;padding:10px 12px;align-items:flex-start;border-bottom:1px solid rgba(212,175,55,.08);color:var(--text-luxury-light)}
      .notif-item:last-child{border-bottom:none}
      .notif-icon{width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center}
      .notif-icon.success{background:rgba(39,174,96,.15);color:#2ecc71}
      .notif-icon.danger{background:rgba(231,76,60,.15);color:#e74c3c}
      .notif-icon.warning{background:rgba(241,196,15,.15);color:#f1c40f}
      .notif-icon.info{background:rgba(52,152,219,.15);color:#3498db}
      .notif-title{font-weight:700;color:var(--luxury-gold);font-size:.95rem}
      .notif-time{font-size:.75rem;color:var(--text-luxury-muted)}
      .notif-tick{cursor:pointer;color:var(--luxury-gold);opacity:.8}
      .notif-tick.read{color:#27ae60;opacity:1}
      .notif-empty{padding:12px;text-align:center;color:var(--text-luxury-muted)}
  .notif-actions{display:flex;gap:8px;align-items:center}
  .notif-download{cursor:pointer;border:none;background:linear-gradient(135deg,#ffd166,#f6ae2d);color:#000;padding:6px 8px;border-radius:8px;font-weight:700;font-size:.78rem;box-shadow:0 6px 16px rgba(246,174,45,.35);transition:transform .12s ease}
  .notif-download:hover{transform:translateY(-1px)}
  .notif-actions{display:flex;gap:8px;align-items:center}
  .notif-download{cursor:pointer;border:none;background:linear-gradient(135deg,#ffd166,#f6ae2d);color:#000;padding:6px 8px;border-radius:8px;font-weight:700;font-size:.78rem;box-shadow:0 6px 16px rgba(246,174,45,.35);transition:transform .12s ease}
  .notif-download:hover{transform:translateY(-1px)}

      /* Notifications logic */
      const notifList = document.getElementById('notif-list');
      const notifBadge = document.getElementById('notif-badge');
      const notifMarkAllBtn = document.getElementById('notif-mark-all');

      function getReadSet(){
        try { return new Set(JSON.parse(localStorage.getItem('notifReadIds')||'[]')); } catch(_) { return new Set(); }
      }
      function saveReadSet(set){ localStorage.setItem('notifReadIds', JSON.stringify(Array.from(set))); }

      function renderNotifications(notifications){
        notifList.innerHTML = '';
        const readSet = getReadSet();
        let unreadCount = 0;

        if (!Array.isArray(notifications) || notifications.length === 0){
          notifList.innerHTML = '<div class="notif-empty">No notifications yet</div>';
        } else {
          notifications.forEach(n => {
            const id = n.id || (n.type + '_' + (n.bookingId || '') + '_' + (n.timestamp || ''));
            const isRead = id && readSet.has(id) ? true : false;
            if (!isRead) unreadCount++;
            const icon = (n.icon || 'fa-bell').replace('fa-', '');
            const sev = (n.severity || 'info').toLowerCase();
            const time = n.timestamp ? new Date(n.timestamp).toLocaleString() : '';
            const item = document.createElement('div');
            item.className = 'notif-item';
            const hasBid = !!n.bookingId;
            const typeStr = (n.type || '').toString().toLowerCase();
            const titleStr = (n.title || '').toString().toLowerCase();
            // Show receipt for booking confirmations and payment confirmations (never for cancellations)
            const isBooking = (
              titleStr.includes('booking confirmed') ||
              typeStr.includes('booking_confirmed') ||
              typeStr.includes('booking confirmed') ||
              typeStr === 'bookingconfirmed'
            );
            const isPayment = (
              titleStr.includes('payment confirmed') ||
              typeStr.includes('payment_confirmed') ||
              typeStr.includes('payment confirmed') ||
              typeStr === 'paymentconfirmed'
            );
            const receiptKind = isBooking ? 'booking' : (isPayment ? 'payment' : null);
            const showDownload = hasBid && !!receiptKind;
            if (showDownload) { try { console.debug('Notif receipt button enabled', { bookingId: n.bookingId, kind: receiptKind, type: n.type, title: n.title }); } catch(_){} }
            const linkHtml = showDownload ? `<div><a href="#" class="notif-receipt-link" data-kind="${receiptKind}" data-bid="${n.bookingId}" style="color:#ffd166;font-weight:700;text-decoration:underline;font-size:.85rem">Download receipt</a></div>` : '';
            item.innerHTML = `
              <div class="notif-icon ${sev}"><i class="fas ${n.icon ? n.icon : 'fa-bell'}"></i></div>
              <div class="notif-content">
                <div class="notif-title">${n.title || 'Notification'}</div>
                <div style="font-size:0.9rem;color:var(--text-luxury-muted);margin-top:4px;">${n.message || ''}</div>
                <div class="notif-time">${time}</div>
                ${linkHtml}
              </div>
              <div class="notif-actions">
                ${showDownload ? `<button class="notif-download" data-kind="${receiptKind}" data-bid="${n.bookingId}" title="Download receipt"><i class="fas fa-download"></i> Receipt</button>` : ''}
                <span class="notif-tick ${isRead ? 'read' : ''}" data-id="${id}" title="Mark as read"><i class="fas fa-check"></i></span>
              </div>`;
            notifList.appendChild(item);
          });
        }

        // Update badge
        if (unreadCount > 0){
          notifBadge.style.display = 'inline-block';
          notifBadge.textContent = unreadCount;
        } else {
          notifBadge.style.display = 'none';
        }
      }

      async function updateNotifications(){
        try {
          const token = localStorage.getItem('token');
          const headers = { 'Accept': 'application/json' };
          if (token) headers['Authorization'] = `Bearer ${token}`;
          const res = await fetch('/api/customer/notifications', { headers });
          const list = await res.json();
          renderNotifications(Array.isArray(list) ? list : []);
        } catch (e) {
          console.error('Failed to load notifications', e);
        }
      }

      // Mark all read
      if (notifMarkAllBtn){
        notifMarkAllBtn.addEventListener('click', () => {
          try {
            const ids = Array.from(notifList.querySelectorAll('.notif-tick')).map(el => el.getAttribute('data-id')).filter(Boolean);
            const set = getReadSet(); ids.forEach(id => set.add(id)); saveReadSet(set);
            updateNotifications();
          } catch(e){ console.error('Failed to mark all read', e); }
        });
      }

      // Tick one notification
      if (notifList){
        notifList.addEventListener('click', (e) => {
          const tick = e.target.closest('.notif-tick');
          if (!tick) return;
          const id = tick.getAttribute('data-id');
          if (!id) return;
          const set = getReadSet(); set.add(id); saveReadSet(set);
          updateNotifications();
        });

        // Download receipt (booking or payment)
        notifList.addEventListener('click', async (e) => {
          const btn = e.target.closest('.notif-download');
          if (!btn) return;
          const bid = btn.getAttribute('data-bid');
          if (!bid) return;
          const kind = btn.getAttribute('data-kind') || 'booking';
          try {
            const token = localStorage.getItem('token');
            const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
            const res = await fetch(`/api/receipts/${kind}/${bid}`, { headers });
            if (!res.ok) throw new Error('Download failed');
            const blob = await res.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            const fname = kind === 'payment' ? `payment-receipt-${bid}.html` : `booking-receipt-${bid}.html`;
            a.href = url; a.download = fname;
            document.body.appendChild(a); a.click(); a.remove();
            window.URL.revokeObjectURL(url);
          } catch(err) {
            console.error(err); alert('Could not download receipt.');
          }
        });
      }

      // Initial load + polling
      updateNotifications();
      setInterval(updateNotifications, 30000);
    </style>
  </head>
  <body>
    <!-- Page Loader -->
    <div class="page-loader">
      <div class="loader-content">
        <div class="loader-spinner"></div>
        <div class="loader-text">VeloRent</div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-luxury fixed-top">
      <div class="container">
        <a class="navbar-brand-luxury" href="/dashboard">
          <i class="fas fa-crown mr-2"></i> VeloRent Dashboard
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link-luxury" href="/dashboard">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link-luxury" href="/feedback" role="button">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link-luxury" href="/security-settings">Security</a>
            </li>
          </ul>
          <div class="auth-buttons">
            <!-- Admin Panel button (shown for admin roles only) -->
            <a id="admin-dashboard-btn" class="btn-luxury btn-luxury-outline mr-2" style="display:none; text-decoration:none;"
               href="javascript:void(0)" title="Admin Panel">
              <i class="fas fa-shield-alt mr-1"></i>Admin Panel
            </a>
            <!-- Notifications Dropdown (inserted) -->
            <div class="dropdown mr-2">
              <button class="btn notifications-toggle dropdown-toggle" type="button" id="notifDropdownBtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Notifications">
                <i class="fas fa-bell"></i>
                <span id="notif-badge" class="notifications-badge" style="display:none;">0</span>
              </button>
              <div class="dropdown-menu dropdown-menu-right notifications-menu" aria-labelledby="notifDropdownBtn">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid rgba(212,175,55,0.1);">
                  <div style="color:var(--luxury-gold);font-weight:700;">Notifications</div>
                  <button id="notif-mark-all" class="btn btn-sm btn-luxury" style="padding:6px 10px;">Mark all read</button>
                </div>
                <div id="notif-list">
                  <div class="notif-empty">No notifications yet</div>
                </div>
              </div>
            </div>
            <!-- Profile Dropdown -->
            <div class="dropdown">
              <button class="btn-luxury btn-luxury-outline dropdown-toggle" type="button" data-toggle="dropdown">
                <i class="fas fa-user-circle mr-1"></i>
                <span id="user-initials">U</span>
              </button>
              <div class="dropdown-menu" style="background: var(--luxury-dark); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: var(--radius-luxury);">
                <div style="padding: 1rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2); text-align: center;">
                  <div style="color: var(--luxury-gold); font-weight: 600;" id="user-name-dropdown">User Name</div>
                  <div style="color: var(--text-luxury-muted); font-size: 0.85rem;" id="user-email-dropdown">user@example.com</div>
                </div>
                <a class="dropdown-item hover-gold" href="/profile" id="profile-dropdown-link" style="color: var(--text-luxury-light); padding: 0.75rem 1rem;">
                  <i class="fas fa-user mr-2"></i>My Profile
                </a>
                <div class="dropdown-divider" style="border-color: rgba(212, 175, 55, 0.2);"></div>
                <a class="dropdown-item hover-gold" href="#" id="logout-btn" style="color: var(--text-luxury-light); padding: 0.75rem 1rem;">
                  <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="dashboard-wrapper">
      <div class="container">
        <main>
        <div id="message-container"></div>

        <div class="dashboard-header">
          <h1 class="dashboard-title">Dashboard</h1>
          <div class="dashboard-actions">
            <a href="/packages" class="btn btn-accent" id="rent-car-btn"><i class="fas fa-car"></i>View All Packges</a>
            <a href="/rental-history" class="btn" id="rental-history-btn"><i class="fas fa-history"></i>Rental History</a>
            <!-- Add vehicle button - hidden by default, shown for fleet managers -->
            <button
              id="add-vehicle-btn"
              class="btn btn-accent"
              style="display: none;"
            >
              <i class="fas fa-plus-circle"></i>Add New Vehicle
            </button>
          </div>
        </div>

        <!-- Regular dashboard content -->
        <div class="dashboard-content" id="regular-dashboard-content">
          <p class="welcome-message" id="welcome-msg">
            Welcome to the Car Rental System, <span id="user-name">User</span>!
            <br />
            <span
              id="user-role"
              style="font-size: 14px; color: var(--light-text)"
              >Your role: Customer</span
            >
          </p>

          <!-- Packages Slider Section (replaces welcome when packages exist) -->
          <div class="packages-section" id="packages-section" style="display:none;">
            <h3 style="display:none;"></h3>
            <div class="packages-slider">
              <div class="packages-track" id="packages-track"><!-- slides injected --></div>
              <div class="packages-nav">
                <button class="prev" id="pkg-prev" aria-label="Previous">â€¹</button>
                <button class="next" id="pkg-next" aria-label="Next">â€º</button>
              </div>
            </div>
          </div>

        </div>
      </main>
      
      <!-- Available Vehicles Section - Full Width -->
      <section class="vehicles-section" style="background: var(--gradient-luxury); padding: 60px 0; min-height: 100vh;">
        <div class="container-fluid" style="max-width: 100%; margin: 0; padding: 0 40px;">
          <div class="section-header" style="text-align: center; margin-bottom: 40px;">
            <h3 style="font-size: 2.5rem; color: var(--luxury-gold); font-family: var(--font-luxury-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
              <i class="fas fa-car-side" style="margin-right: 15px;"></i>Available Luxury Vehicles
            </h3>
            <p style="color: var(--text-luxury-muted); font-size: 1.2rem; font-weight: 500;">Discover our premium collection of luxury vehicles</p>
          </div>
          
          <!-- Advanced Filter Section -->
          <div class="advanced-filters" style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%); padding: 30px; border-radius: var(--radius-luxury-large); border: 1px solid rgba(212, 175, 55, 0.2); margin-bottom: 40px; box-shadow: var(--shadow-luxury); width: 100%; margin: 0 0 40px 0;">
            <div class="filter-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; align-items: end;">
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-search mr-2"></i>Search Vehicles
                </label>
                <input type="text" id="vehicle-search" class="form-control" placeholder="Search by make, model, or year..." style="padding: 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500;">
              </div>
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-building mr-2"></i>Make
                </label>
                <select id="make-filter" class="form-control" style="padding: 12px 40px 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500; cursor: pointer; position: relative; z-index: 10;">
                  <option value="">All Makes</option>
                </select>
              </div>
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-car mr-2"></i>Model
                </label>
                <select id="model-filter" class="form-control" style="padding: 12px 40px 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500; cursor: pointer; position: relative; z-index: 10;">
                  <option value="">All Models</option>
                </select>
              </div>
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-calendar mr-2"></i>Year
                </label>
                <select id="year-filter" class="form-control" style="padding: 12px 40px 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500; cursor: pointer; position: relative; z-index: 10;">
                  <option value="">All Years</option>
                </select>
              </div>
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-dollar-sign mr-2"></i>Price Range
                </label>
                <select id="price-filter" class="form-control" style="padding: 12px 40px 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500; cursor: pointer; position: relative; z-index: 10;">
                  <option value="">Any Price</option>
                  <option value="0-5000">Under Rs. 5,000/day</option>
                  <option value="5000-15000">Rs. 5,000 - Rs. 15,000/day</option>
                  <option value="15000-30000">Rs. 15,000 - Rs. 30,000/day</option>
                  <option value="30000+">Rs. 30,000+/day</option>
                </select>
              </div>
              <div class="filter-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--luxury-gold); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.5px; font-family: var(--font-luxury-primary);">
                  <i class="fas fa-sort mr-2"></i>Sort By
                </label>
                <select id="sort-select" class="form-control" style="padding: 12px 40px 12px 15px; border: 2px solid rgba(212, 175, 55, 0.3); border-radius: var(--radius-luxury-small); background: rgba(0, 0, 0, 0.3); color: var(--text-luxury-light); font-weight: 500; cursor: pointer; position: relative; z-index: 10;">
                  <option value="default">Default</option>
                  <option value="price-low">Price: Low to High</option>
                  <option value="price-high">Price: High to Low</option>
                  <option value="year-new">Year: Newest First</option>
                  <option value="year-old">Year: Oldest First</option>
                  <option value="make">Make: A-Z</option>
                </select>
              </div>
            </div>
            <div class="filter-actions" style="margin-top: 25px; text-align: center;">
              <button id="clear-filters" class="btn" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; padding: 12px 24px; border: none; border-radius: var(--radius-luxury-small); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; transition: var(--transition-smooth);">
                <i class="fas fa-times mr-2"></i>Clear Filters
              </button>
            </div>
          </div>
          <div id="loading-vehicles" class="loading" style="text-align: center; padding: 40px; color: var(--luxury-gold); font-size: 1.2rem;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <p>Loading luxury vehicles...</p>
          </div>
          <div id="vehicles-container" style="display: none;">
            <div class="vehicles-results" style="margin-bottom: 20px; text-align: center;">
              <span id="results-count" style="color: var(--text-luxury-muted); font-size: 1.1rem; font-weight: 500;">Showing all vehicles</span>
            </div>
            <div id="vehicles-grid" class="vehicles-grid-enhanced" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; padding: 0; width: 100%; margin: 0;">
              <!-- Vehicle cards will be populated dynamically -->
            </div>
          </div>
        </div>
      </section>
      
      <div class="container">
      <!-- Vehicle Details Modal -->
      <div id="vehicle-details-modal" class="modal">
        <div class="modal-content" style="max-width: 950px; background: linear-gradient(135deg, var(--luxury-charcoal) 0%, #1a1a1a 100%); color: var(--text-luxury-light); border: 2px solid rgba(212, 175, 55, 0.3); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(212, 175, 55, 0.1);">
          <div class="modal-header" style="background: linear-gradient(90deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%); border-bottom: 2px solid rgba(212, 175, 55, 0.3); padding: 25px; margin: -20px -20px 0 -20px; border-radius: 8px 8px 0 0;">
            <div style="display: flex; align-items: center; gap: 15px;">
              <div style="background: var(--gradient-gold); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; color: var(--luxury-black);">
                <i class="fa fa-car" style="font-size: 20px;"></i>
              </div>
              <div>
                <h2 class="modal-title" style="color: var(--luxury-gold); font-size: 24px; margin: 0; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                  <span id="modal-vehicle-title">Premium Vehicle Details</span>
                </h2>
                <p style="margin: 5px 0 0 0; color: rgba(255, 255, 255, 0.7); font-size: 14px;">Discover luxury on wheels</p>
              </div>
            </div>
            <span class="close" role="button" tabindex="0" onclick="closeVehicleDetailsModal()" onkeydown="if(event.key==='Enter'||event.key==='Escape'){closeVehicleDetailsModal()}" style="color: var(--luxury-gold); font-size: 32px; font-weight: 300; transition: all 0.3s ease; cursor: pointer; padding: 10px;">&times;</span>
          </div>
          
          <div id="vehicle-details-content" style="padding: 30px 25px;">
            <div class="vehicle-details-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;">
              
              <!-- Left Column - Image & Gallery -->
              <div class="vehicle-details-image" style="position: relative;">
                <div style="position: relative; border-radius: 15px; overflow: hidden; background: linear-gradient(45deg, rgba(212, 175, 55, 0.1) 0%, transparent 100%); padding: 3px;">
                  <img id="modal-vehicle-image" src="" alt="Vehicle" style="width: 100%; height: 280px; object-fit: cover; border-radius: 12px; transition: transform 0.3s ease;">
                  <div style="position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); padding: 8px 15px; border-radius: 20px; color: var(--luxury-gold); font-size: 12px; font-weight: 600;">
                    <i class="fa fa-star" style="margin-right: 5px;"></i>PREMIUM
                  </div>
                </div>
                
                <!-- Features Badges -->
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 20px;">
                  <span style="background: rgba(212, 175, 55, 0.15); color: var(--luxury-gold); padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid rgba(212, 175, 55, 0.3);">
                    <i class="fa fa-shield-alt" style="margin-right: 5px;"></i>INSURED
                  </span>
                  <span style="background: rgba(46, 204, 113, 0.15); color: #2ecc71; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid rgba(46, 204, 113, 0.3);">
                    <i class="fa fa-check-circle" style="margin-right: 5px;"></i>VERIFIED
                  </span>
                  <span style="background: rgba(52, 152, 219, 0.15); color: #3498db; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid rgba(52, 152, 219, 0.3);">
                    <i class="fa fa-cog" style="margin-right: 5px;"></i>AUTO
                  </span>
                </div>
              </div>
              
              <!-- Right Column - Details -->
              <div class="vehicle-details-info">
                <div style="background: rgba(255, 255, 255, 0.03); border-radius: 15px; padding: 25px; border: 1px solid rgba(212, 175, 55, 0.2);">
                  
                  <!-- Vehicle Specs Grid -->
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    
                    <div style="background: rgba(212, 175, 55, 0.05); padding: 15px; border-radius: 10px; border-left: 3px solid var(--luxury-gold);">
                      <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Brand</div>
                      <div id="modal-vehicle-make" style="color: var(--luxury-gold); font-size: 16px; font-weight: 600;"></div>
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.05); padding: 15px; border-radius: 10px; border-left: 3px solid var(--luxury-gold);">
                      <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Model</div>
                      <div id="modal-vehicle-model" style="color: var(--luxury-gold); font-size: 16px; font-weight: 600;"></div>
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.05); padding: 15px; border-radius: 10px; border-left: 3px solid var(--luxury-gold);">
                      <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Year</div>
                      <div id="modal-vehicle-year" style="color: var(--luxury-gold); font-size: 16px; font-weight: 600;"></div>
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.05); padding: 15px; border-radius: 10px; border-left: 3px solid var(--luxury-gold);">
                      <div style="color: rgba(255, 255, 255, 0.6); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Registration</div>
                      <div id="modal-vehicle-registration" style="color: var(--luxury-gold); font-size: 16px; font-weight: 600;"></div>
                    </div>
                    
                  </div>
                  
                  <!-- Price Section -->
                  <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; border: 1px solid rgba(212, 175, 55, 0.3);">
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Rental Rate</div>
                    <div id="modal-vehicle-rate" style="color: var(--luxury-gold); font-size: 28px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>
                    <div style="color: rgba(255, 255, 255, 0.5); font-size: 12px; margin-top: 5px;">Best price guaranteed</div>
                  </div>
                  
                  <!-- Status -->
                  <div style="display: flex; align-items: center; justify-content: center; gap: 10px; padding: 15px; background: rgba(46, 204, 113, 0.1); border-radius: 10px; border: 1px solid rgba(46, 204, 113, 0.3);">
                    <i class="fa fa-check-circle" style="color: #27ae60; font-size: 16px;"></i>
                    <span style="color: rgba(255, 255, 255, 0.6); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Status:</span>
                    <span id="modal-vehicle-status" style="color: #27ae60; font-weight: 600;"></span>
                  </div>
                  
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions" style="margin-top: 40px; display: flex; gap: 15px; justify-content: center; padding-top: 25px; border-top: 1px solid rgba(212, 175, 55, 0.2);">
              <button type="button" class="btn" onclick="closeVehicleDetailsModal()" style="background: transparent; border: 2px solid rgba(255, 255, 255, 0.3); color: rgba(255, 255, 255, 0.8); padding: 12px 30px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; min-width: 120px;">
                <i class="fa fa-times" style="margin-right: 8px;"></i>Close
              </button>
              <button type="button" class="btn btn-accent" id="rent-vehicle-btn" onclick="openBookingModal()" style="background: var(--gradient-gold); border: none; color: var(--luxury-black); padding: 12px 30px; border-radius: 8px; font-weight: 700; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); min-width: 160px;">
                <i class="fa fa-calendar-check" style="margin-right: 8px;"></i>Rent This Vehicle
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Package Details Modal -->
      <div id="package-details-modal" class="modal">
        <div class="modal-content" style="max-width: 900px; background: var(--luxury-charcoal); color: var(--text-luxury-light);">
          <div class="modal-header" style="border-bottom: 2px solid rgba(212, 175, 55, 0.3);">
            <h2 class="modal-title" style="color: var(--luxury-gold);"><i class="fa fa-gift"></i> <span id="pkg-modal-title">Package Details</span></h2>
            <span class="close" role="button" tabindex="0" onclick="closePackageDetailsModal()" onkeydown="if(event.key==='Enter'||event.key==='Escape'){closePackageDetailsModal()}" style="color: var(--luxury-gold);">&times;</span>
          </div>
          <div id="package-details-content">
            <div style="display:flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px;">
              <img id="pkg-modal-image" class="package-image" src="" style="width:250px; height:160px; border-radius: 8px; border: 2px solid rgba(212, 175, 55, 0.3);" alt="Package"/>
              <div style="flex:1; min-width:300px;">
                <div style="margin:10px 0; padding: 8px; background: rgba(212, 175, 55, 0.1); border-radius: 6px;">
                  <strong style="color: var(--luxury-gold);">Price:</strong> <span id="pkg-modal-price" style="color: var(--luxury-gold); font-size: 1.2rem; font-weight: 700;">Rs. 0.00</span>
                </div>
                <div style="margin:10px 0; padding: 8px; background: rgba(212, 175, 55, 0.1); border-radius: 6px;">
                  <strong style="color: var(--luxury-gold);">Duration:</strong> <span id="pkg-modal-duration">0 days</span>
                </div>
                <div style="margin:10px 0; padding: 8px; background: rgba(212, 175, 55, 0.1); border-radius: 6px;">
                  <strong style="color: var(--luxury-gold);">Status:</strong> <span id="pkg-modal-status" style="color: #27ae60; font-weight: 600;">Activated</span>
                </div>
              </div>
            </div>
            <div style="margin-top: 20px;">
              <h4 style="color: var(--luxury-gold); margin-bottom: 15px; display: flex; align-items: center;"><i class="fas fa-car mr-2"></i>Included Vehicles:</h4>
              <ul id="pkg-modal-vehicles" style="margin:0; padding:0; list-style: none;"></ul>
            </div>
            <div class="form-actions" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 15px;">
              <button type="button" class="btn" onclick="closePackageDetailsModal()" style="background: transparent; border: 2px solid var(--luxury-gold); color: var(--luxury-gold);">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Modal -->
      <div id="booking-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h2 class="modal-title"><i class="fa fa-calendar"></i> Book Vehicle</h2>
            <span class="close" role="button" tabindex="0" onclick="closeBookingModal()" onkeydown="if(event.key==='Enter'||event.key==='Escape'){closeBookingModal()}">&times;</span>
          </div>
          <div id="booking-content">
            <form id="booking-form">
              <input type="hidden" id="booking-vehicle-id" name="vehicleId">

              <div class="form-group">
                <label for="booking-start-date">Start Date</label>
                <input type="date" id="booking-start-date" class="form-control" required min="">
              </div>

              <div class="form-group">
                <label for="booking-end-date">End Date</label>
                <input type="date" id="booking-end-date" class="form-control" required min="">
              </div>

              <div class="form-group">
                <label>Rental Duration</label>
                <div id="rental-duration">0 days</div>
              </div>

              <div class="form-group">
                <label>Cost Calculation</label>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                  <tr>
                    <td>Daily Rate:</td>
                    <td id="daily-rate-display" style="text-align: right;">Rs. 0.00</td>
                  </tr>
                  <tr>
                    <td>Number of Days:</td>
                    <td id="days-count-display" style="text-align: right;">0</td>
                  </tr>
                  <tr style="font-weight: bold; border-top: 1px solid var(--border-color); margin-top: 5px;">
                    <td>Total Cost:</td>
                    <td id="total-cost-display" style="text-align: right;">Rs. 0.00</td>
                  </tr>
                </table>
                <input type="hidden" id="booking-total-cost" name="totalCost" value="0">
              </div>

              <div id="booking-message" class="message" style="display: none;"></div>

              <div class="form-actions">
                <button type="button" class="btn" onclick="closeBookingModal()">Cancel</button>
                <button type="submit" class="btn btn-accent" id="confirm-booking-btn">Confirm Booking</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Package Booking Modal -->
      <div id="package-booking-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h2 class="modal-title"><i class="fa fa-calendar"></i> Book Package</h2>
            <span class="close" role="button" tabindex="0" onclick="closePackageBookingModal()" onkeydown="if(event.key==='Enter'||event.key==='Escape'){closePackageBookingModal()}">&times;</span>
          </div>
          <div id="package-booking-content">
            <form id="package-booking-form">
              <input type="hidden" id="package-booking-id" name="packageId">

              <div class="package-info-summary" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; gap: 15px;">
                  <img id="package-booking-image" src="" alt="Package" style="width: 100px; height: 80px; object-fit: cover; border-radius: 4px;">
                  <div>
                    <h4 id="package-booking-name" style="margin: 0 0 8px 0; color: var(--primary-color);"></h4>
                    <div id="package-booking-duration" style="color: var(--light-text); margin-bottom: 4px;"></div>
                    <div id="package-booking-price" style="font-weight: bold; color: var(--accent-color); font-size: 1.1em;"></div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="package-start-date">Start Date</label>
                <input type="date" id="package-start-date" class="form-control" required min="">
              </div>

              <div class="form-group">
                <label for="package-end-date">End Date</label>
                <input type="date" id="package-end-date" class="form-control" required min="">
              </div>

              <div class="form-group">
                <label>Booking Duration</label>
                <div id="package-rental-duration">0 days</div>
              </div>

              <div class="form-group">
                <label>Cost Calculation</label>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                  <tr>
                    <td>Package Price:</td>
                    <td id="package-price-display" style="text-align: right;">Rs. 0.00</td>
                  </tr>
                  <tr>
                    <td>Duration:</td>
                    <td id="package-days-display" style="text-align: right;">0 days</td>
                  </tr>
                  <tr style="border-top: 1px solid #ddd; font-weight: bold;">
                    <td>Total Cost:</td>
                    <td id="package-total-cost" style="text-align: right;">Rs. 0.00</td>
                  </tr>
                </table>
              </div>

              <div class="form-actions">
                <button type="button" class="btn" onclick="closePackageBookingModal()">Cancel</button>
                <button type="submit" class="btn btn-accent">Proceed to Payment</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Payment Processing Modal -->
      <div id="payment-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h2 class="modal-title"><i class="fa fa-credit-card"></i> Payment</h2>
            <span class="close" role="button" tabindex="0" onclick="closePaymentModal()" onkeydown="if(event.key==='Enter'||event.key==='Escape'){closePaymentModal()}">&times;</span>
          </div>
          <div id="payment-content">
            <div class="payment-summary" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
              <h4 style="margin: 0 0 10px 0;">Booking Summary</h4>
              <div id="payment-booking-details"></div>
            </div>

            <form id="payment-form">
              <input type="hidden" id="payment-booking-id">

              <div class="form-group">
                <label>Payment Method</label>
                <div class="payment-methods">
                  <label class="payment-method-option">
                    <input type="radio" name="paymentMethod" value="credit_card" checked>
                    <span class="payment-method-label">
                      <i class="fa fa-credit-card"></i> Credit Card
                    </span>
                  </label>
                  <label class="payment-method-option">
                    <input type="radio" name="paymentMethod" value="debit_card">
                    <span class="payment-method-label">
                      <i class="fa fa-credit-card"></i> Debit Card
                    </span>
                  </label>
                  <label class="payment-method-option">
                    <input type="radio" name="paymentMethod" value="upi">
                    <span class="payment-method-label">
                      <i class="fa fa-mobile"></i> UPI
                    </span>
                  </label>
                  <label class="payment-method-option">
                    <input type="radio" name="paymentMethod" value="cash">
                    <span class="payment-method-label">
                      <i class="fa fa-money"></i> Cash
                    </span>
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn" onclick="closePaymentModal()">Cancel</button>
                <button type="submit" class="btn btn-accent">
                  <i class="fa fa-check"></i> Complete Payment
                </button>
              </div>
            </form>
          </div>

          <div id="payment-processing" style="display: none; text-align: center; padding: 40px;">
            <div class="loading-spinner"></div>
            <p style="margin-top: 15px;">Processing your payment...</p>
          </div>

          <div id="payment-success" style="display: none; text-align: center; padding: 40px;">
            <div style="color: var(--accent-color); font-size: 48px; margin-bottom: 15px;">
              <i class="fa fa-check-circle"></i>
            </div>
            <h3 style="color: var(--accent-color); margin-bottom: 10px;">Payment Successful!</h3>
            <p style="margin-bottom: 20px;">Your package has been booked successfully.</p>
            <div id="booking-confirmation-details"></div>
            <button class="btn btn-accent" onclick="closePaymentModal(); loadDashboard();">Continue</button>
          </div>
        </div>
      </div>
      </div>

      </div>
      
      <footer>
        <div class="footer-content">
          <p>&copy; <span class="footer-year">2025</span> <span class="footer-brand">VeloRent</span> - Luxury Car Rental System. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <!-- Scripts -->
    <script th:src="@{/js/package-booking-fix.js}"></script>
    <script th:src="@{/js/jQuery/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/css/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/dashboard-vehicles.js}"></script>
    <script th:src="@{/js/notifications.js}"></script>
    <script>
      $('#admin-dashboard-btn').on('click', function() {
        if(localStorage.getItem("userRole") && localStorage.getItem("userRole").includes("OWNER")){
          window.location.href = "/owner/dashboard" ;
        }else{
          window.location.href = "/admin/dashboard" ;
        }
      });
      document.addEventListener("DOMContentLoaded", () => {
        // Check if user is logged in
        const token = localStorage.getItem("token");
        const userRole = localStorage.getItem("userRole");

        if (!token) {
          window.location.href =
            "/login?message=" +
            encodeURIComponent("Please log in to access the dashboard") +
            "&type=error";
          return;
        }

        // Update user role display
        const userRoleElement = document.getElementById("user-role");
        if (userRoleElement && userRole) {
          userRoleElement.textContent =
            "Your role: " + userRole.replace("ROLE_", "");
        }

        // Wire 'Rent a Car' navigator to packages with login guard
        const rentBtn = document.getElementById('rent-car-btn');
        if (rentBtn) {
          rentBtn.addEventListener('click', function(e){
            // If we already set href, just ensure token exists; otherwise redirect to login with return
            const t = localStorage.getItem('token');
            if (!t) {
              e.preventDefault();
              window.location.href = '/login?message=' + encodeURIComponent('Please log in to view packages') + '&type=error&returnUrl=' + encodeURIComponent('/packages');
              return false;
            }
            // Allow normal navigation to /packages
          });
        }

        // Check for query parameter messages
        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get("message");
        const type = urlParams.get("type") || "info";

        if (message) {
          const messageContainer = document.getElementById("message-container");
          messageContainer.textContent = message;
          messageContainer.className = `message ${type}`;

          // Remove the query parameters from the URL
          window.history.replaceState(
            {},
            document.title,
            window.location.pathname
          );
        }

        // Setup logout button
        const logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();

            // Clear all authentication data
            localStorage.clear();

            // Redirect to login
            window.location.href =
              "/login?message=" +
              encodeURIComponent("You have been logged out") +
              "&type=success";
          });
        }

        // Show admin dashboard link for admin users
        const adminDashboardBtn = document.getElementById("admin-dashboard-btn");
        if (adminDashboardBtn && userRole) {
          const adminRoles = ["SYSTEM_ADMIN", "OWNER", "FLEETMANAGER"];
          // Check if userRole contains any of the admin role strings
          if (adminRoles.some((role) => userRole.includes(role))) {
            adminDashboardBtn.style.display = "inline-block";
          }
        }



        // Set user name and email in profile dropdown
        const userName = localStorage.getItem("userName") || "User";
        const userEmail = localStorage.getItem("userEmail") || "user@example.com";
        document.getElementById("user-name-dropdown").textContent = userName;
        document.getElementById("user-email-dropdown").textContent = userEmail;
        document.getElementById("user-name").textContent = userName;

        // Set user initials in profile icon
        const userInitials = userName
          .split(" ")
          .map((n) => n.charAt(0))
          .join("")
          .toUpperCase();
        document.getElementById("user-initials").textContent = userInitials;

        // Update profile links to include user email
        const profileNavLink = document.getElementById("profile-nav-link");
        const profileDropdownLink = document.getElementById("profile-dropdown-link");
        console.log("Profile link update - userEmail:", userEmail);
        console.log("Profile nav link found:", !!profileNavLink);
        console.log("Profile dropdown link found:", !!profileDropdownLink);

        if (profileNavLink && userEmail) {
          profileNavLink.href = `/profile?email=${encodeURIComponent(userEmail)}`;
          console.log("Updated profile nav link href:", profileNavLink.href);
        }
        if (profileDropdownLink && userEmail) {
          profileDropdownLink.href = `/profile?email=${encodeURIComponent(userEmail)}`;
          console.log("Updated profile dropdown link href:", profileDropdownLink.href);
        }

        // Setup logout button in dropdown
        const logoutBtnDropdown = document.getElementById("logout-btn-dropdown");
        if (logoutBtnDropdown) {
          logoutBtnDropdown.addEventListener("click", (e) => {
            e.preventDefault();
            // Reuse the logout logic
            logoutBtn.click();
          });
        }

        // If fleet manager, redirect to the fleet manager dashboard
        if (userRole && (userRole.includes("FLEET_MANAGER"))) {
          window.location.href = "/fleet-manager/dashboard";
        }

        // Debug navigation links
        const aboutUsLink = document.querySelector('a[href="/feedback"]');
        if (aboutUsLink) {
          console.log('About Us link found:', aboutUsLink);
          aboutUsLink.addEventListener('click', function(e) {
            console.log('About Us link clicked, navigating to:', this.href);
            // Let the default behavior happen (navigate to /feedback)
          });
        } else {
          console.error('About Us link not found');
        }

        // Ensure all navigation links work
        document.querySelectorAll('.nav-link-luxury').forEach(link => {
          link.addEventListener('click', function(e) {
            console.log('Navigation link clicked:', this.href);
            // Allow default navigation unless it's a special case
          });
        });

        // Load packages for customers (replaces welcome section)
        loadActivePackages();

        // Load available vehicles for customers
        loadAvailableVehicles();

        // Setup advanced filtering functionality for vehicles
        const vehicleSearch = document.getElementById("vehicle-search");
        const makeFilter = document.getElementById("make-filter");
        const modelFilter = document.getElementById("model-filter");
        const yearFilter = document.getElementById("year-filter");
        const priceFilter = document.getElementById("price-filter");
        const sortSelect = document.getElementById("sort-select");
        const clearFiltersBtn = document.getElementById("clear-filters");

        // Debug: Check if elements are found
        console.log('Filter elements found:', {
          vehicleSearch: !!vehicleSearch,
          makeFilter: !!makeFilter,
          modelFilter: !!modelFilter,
          yearFilter: !!yearFilter,
          priceFilter: !!priceFilter,
          sortSelect: !!sortSelect,
          clearFiltersBtn: !!clearFiltersBtn
        });

        // Ensure dropdowns are clickable
        [makeFilter, modelFilter, yearFilter, priceFilter, sortSelect].forEach(element => {
          if (element) {
            element.style.pointerEvents = 'auto';
            element.style.cursor = 'pointer';
            element.addEventListener('click', function(e) {
              console.log('Dropdown clicked:', element.id);
            });
          }
        });

        // Add event listeners for all filters
        if (vehicleSearch) vehicleSearch.addEventListener("input", filterAndSortVehicles);
        if (makeFilter) makeFilter.addEventListener("change", filterAndSortVehicles);
        if (modelFilter) modelFilter.addEventListener("change", filterAndSortVehicles);
        if (yearFilter) yearFilter.addEventListener("change", filterAndSortVehicles);
        if (priceFilter) priceFilter.addEventListener("change", filterAndSortVehicles);
        if (sortSelect) sortSelect.addEventListener("change", filterAndSortVehicles);
        if (clearFiltersBtn) clearFiltersBtn.addEventListener("click", clearAllFilters);

        // Make populateFilterDropdowns available globally
        window.populateFilterDropdowns = populateFilterDropdowns;

        // Initial filter setup - this will be called from loadAvailableVehicles
        // after vehicles are loaded

        // Populate filter dropdowns
        function populateFilterDropdowns() {
          if (!allVehicles || allVehicles.length === 0) return;

          // Get unique values
          const makes = [...new Set(allVehicles.map(v => v.make).filter(Boolean))].sort();
          const models = [...new Set(allVehicles.map(v => v.model).filter(Boolean))].sort();
          const years = [...new Set(allVehicles.map(v => v.year).filter(Boolean))].sort((a, b) => b - a);

          // Populate make filter
          if (makeFilter) {
            makeFilter.innerHTML = '<option value="">All Makes</option>';
            makes.forEach(make => {
              makeFilter.innerHTML += `<option value="${make}">${make}</option>`;
            });
          }

          // Populate model filter
          if (modelFilter) {
            modelFilter.innerHTML = '<option value="">All Models</option>';
            models.forEach(model => {
              modelFilter.innerHTML += `<option value="${model}">${model}</option>`;
            });
          }

          // Populate year filter
          if (yearFilter) {
            yearFilter.innerHTML = '<option value="">All Years</option>';
            years.forEach(year => {
              yearFilter.innerHTML += `<option value="${year}">${year}</option>`;
            });
          }
        }

        // Clear all filters
        function clearAllFilters() {
          if (vehicleSearch) vehicleSearch.value = '';
          if (makeFilter) makeFilter.value = '';
          if (modelFilter) modelFilter.value = '';
          if (yearFilter) yearFilter.value = '';
          if (priceFilter) priceFilter.value = '';
          if (sortSelect) sortSelect.value = 'default';
          filterAndSortVehicles();
        }

        // Enhanced filter and sort function
        function filterAndSortVehicles() {
          console.log('filterAndSortVehicles called, allVehicles count:', allVehicles.length);

          const searchTerm = vehicleSearch ? vehicleSearch.value.toLowerCase() : '';
          const makeValue = makeFilter ? makeFilter.value : '';
          const modelValue = modelFilter ? modelFilter.value : '';
          const yearValue = yearFilter ? yearFilter.value : '';
          const priceValue = priceFilter ? priceFilter.value : '';
          const sortValue = sortSelect ? sortSelect.value : 'default';

          console.log('Filter values:', { searchTerm, makeValue, modelValue, yearValue, priceValue, sortValue });

          let filteredVehicles = allVehicles.filter(vehicle => {
            // Search filter
            if (searchTerm && searchTerm.trim() !== '') {
              const searchableText = [
                vehicle.make || '',
                vehicle.model || '',
                vehicle.year ? vehicle.year.toString() : '',
                vehicle.status || '',
                vehicle.registrationNumber || ''
              ].join(' ').toLowerCase().trim();

              if (!searchableText.includes(searchTerm.trim())) return false;
            }

            // Make filter
            if (makeValue && vehicle.make !== makeValue) return false;

            // Model filter
            if (modelValue && vehicle.model !== modelValue) return false;

            // Year filter
            if (yearValue && vehicle.year != yearValue) return false;

            // Price filter
            if (priceValue) {
              const price = parseFloat(vehicle.has_discount ? vehicle.discountedRatePerDay : vehicle.rentalRatePerDay) || 0;
              switch(priceValue) {
                case '0-5000':
                  if (price >= 5000) return false;
                  break;
                case '5000-15000':
                  if (price < 5000 || price >= 15000) return false;
                  break;
                case '15000-30000':
                  if (price < 15000 || price >= 30000) return false;
                  break;
                case '30000+':
                  if (price < 30000) return false;
                  break;
              }
            }

            return true;
          });

          // Apply sorting
          switch(sortValue) {
            case 'price-low':
              filteredVehicles.sort((a, b) => {
                const priceA = parseFloat(a.has_discount ? a.discountedRatePerDay : a.rentalRatePerDay) || 0;
                const priceB = parseFloat(b.has_discount ? b.discountedRatePerDay : b.rentalRatePerDay) || 0;
                return priceA - priceB;
              });
              break;
            case 'price-high':
              filteredVehicles.sort((a, b) => {
                const priceA = parseFloat(a.has_discount ? a.discountedRatePerDay : a.rentalRatePerDay) || 0;
                const priceB = parseFloat(b.has_discount ? b.discountedRatePerDay : b.rentalRatePerDay) || 0;
                return priceB - priceA;
              });
              break;
            case 'year-new':
              filteredVehicles.sort((a, b) => {
                const yearA = parseInt(a.year) || 0;
                const yearB = parseInt(b.year) || 0;
                return yearB - yearA;
              });
              break;
            case 'year-old':
              filteredVehicles.sort((a, b) => {
                const yearA = parseInt(a.year) || 0;
                const yearB = parseInt(b.year) || 0;
                return yearA - yearB;
              });
              break;
            case 'make':
              filteredVehicles.sort((a, b) => (a.make || '').localeCompare(b.make || ''));
              break;
            default:
              // Keep original order
              break;
          }

          // Update results count
          const resultsCount = document.getElementById('results-count');
          if (resultsCount) {
            const total = allVehicles.length;
            const filtered = filteredVehicles.length;
            if (filtered === total) {
              resultsCount.textContent = `Showing all ${total} vehicles`;
            } else {
              resultsCount.textContent = `Showing ${filtered} of ${total} vehicles`;
            }
          }

          displayVehicles(filteredVehicles);
        }

        // Make function available globally
        window.filterAndSortVehicles = filterAndSortVehicles;

        // Test function
        window.testFilters = function() {
          console.log('Testing filters...');
          console.log('allVehicles:', allVehicles?.length || 0);
          console.log('Search input:', document.getElementById('vehicle-search')?.value);
          console.log('Make filter:', document.getElementById('make-filter')?.value);
          filterAndSortVehicles();
        };


        function loadActivePackages() {
          const track = document.getElementById('packages-track');
          const section = document.getElementById('packages-section');
          const welcome = document.getElementById('welcome-msg');
          fetch('/api/public/packages', {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
          })
          .then(r => r.json())
          .then((list) => {
            if (!Array.isArray(list)) return;
            // Show both activated and partially reserved packages
            const visible = list.filter(p => {
              const status = (p.status || '').toLowerCase();
              return status === 'activated' || status === 'partially reserved';
            });
            if (visible.length === 0) return;
            // Hide welcome, show section with luxury title
            if (welcome) welcome.style.display = 'none';
            section.style.display = 'block';

            // Update section title dynamically
            const sectionTitle = section.querySelector('h3');
            if (sectionTitle) { sectionTitle.innerHTML = ''; sectionTitle.style.display = 'none'; }
            // Build slides
            track.innerHTML = '';
            const indicators = document.createElement('div');
            indicators.className = 'packages-indicators';

            visible.forEach((p, idx) => {
              const slide = document.createElement('div');
              const isPartiallyReserved = (p.status || '').toLowerCase() === 'partially reserved';
              slide.className = `package-slide ${isPartiallyReserved ? 'partially-reserved' : ''}`;
              const imgSrc = p.imageUrl || 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
              // Set background image on slide
              slide.style.backgroundImage = `url('${imgSrc}')`;

              // Availability message for partially reserved packages
              const availabilityMessage = isPartiallyReserved ?
                `<div class="availability-notice">
                  <i class="fas fa-clock"></i>
                  <small>Temporarily unavailable - Some vehicles are currently rented individually</small>
                </div>` : '';

              // Slide overlay content
              slide.innerHTML = `
                <div class="package-content">
                  <div class="package-info">
                    <h4>${p.packageName || 'Luxury Package'}</h4>
                    <div class="package-meta">Duration: <strong>${p.duration || 0} days</strong></div>
                    <div class="package-meta">Starting from: <strong>Rs. ${p.price || 0}</strong></div>
                    ${availabilityMessage}
                  </div>
                  <div class="package-actions">
                    <button class="btn view-details-btn" data-pkg-idx="${idx}">View Details</button>
                  </div>
                </div>`;

              track.appendChild(slide);

              // Create indicator
              const indicator = document.createElement('div');
              indicator.className = `package-indicator ${idx === 0 ? 'active' : ''}`;
              indicator.onclick = () => goToSlide(idx);
              indicators.appendChild(indicator);
            });

            // Add indicators to slider (remove existing first to avoid duplicates on reload)
            const packageSlider = document.querySelector('.packages-slider');
            const existingIndicators = packageSlider.querySelector('.packages-indicators');
            if (existingIndicators) existingIndicators.remove();
            packageSlider.appendChild(indicators);

            // Enhanced Controls with Indicators
            let current = 0; const total = visible.length;

            function updateIndicators() {
              document.querySelectorAll('.package-indicator').forEach((ind, i) => {
                ind.classList.toggle('active', i === current);
              });
            }

            function go(i){
              current = (i + total) % total;
              track.style.transform = `translateX(-${current*100}%)`;
              updateIndicators();
            }

            function goToSlide(i) {
              current = i;
              track.style.transform = `translateX(-${current*100}%)`;
              updateIndicators();
              // Reset timer
              clearInterval(timer);
              if (total > 1) timer = setInterval(() => go(current+1), 5000);
            }

            const prev = document.getElementById('pkg-prev');
            const next = document.getElementById('pkg-next');
            prev.onclick = () => {
              clearInterval(timer);
              go(current-1);
              if (total > 1) timer = setInterval(() => go(current+1), 5000);
            };
            next.onclick = () => {
              clearInterval(timer);
              go(current+1);
              if (total > 1) timer = setInterval(() => go(current+1), 5000);
            };

            // Start auto-slide timer only if there are multiple packages
            let timer;
            if (total > 1) {
              timer = setInterval(() => go(current+1), 5000);

              // Pause on hover
              const packageSliderElement = document.querySelector('.packages-slider');
              packageSliderElement.addEventListener('mouseenter', () => clearInterval(timer));
              packageSliderElement.addEventListener('mouseleave', () => {
                if (total > 1) timer = setInterval(() => go(current+1), 5000);
              });
            }

            // Make goToSlide available globally for indicators
            window.goToSlide = goToSlide;

            // Initialize first slide
            updateIndicators();

            // Wire buttons
            track.querySelectorAll('[data-pkg-idx]').forEach(btn => {
              btn.addEventListener('click', (e) => {
                const idx = parseInt(e.currentTarget.getAttribute('data-pkg-idx'));
                showPackageDetails(visible[idx]);
              });
            });
            track.querySelectorAll('[data-pkg-buy-idx]').forEach(btn => {
              btn.addEventListener('click', (e) => {
                const idx = parseInt(e.currentTarget.getAttribute('data-pkg-buy-idx'));
                const pkg = visible[idx];
                // Check if package is partially reserved before allowing booking
                if ((pkg.status || '').toLowerCase() === 'partially reserved') {
                  showMessage('This package is temporarily unavailable because one or more vehicles are currently rented individually. Please try again later when the vehicles are returned.', 'warning');
                  return;
                }
                buyPackage(pkg);
              });
            });
          })
          .catch(err => { console.error('Failed to load packages', err); });
        }

        function showPackageDetails(pkg){
          if (!pkg) return;
          document.getElementById('pkg-modal-title').textContent = pkg.packageName || 'Package Details';
          document.getElementById('pkg-modal-image').src = pkg.imageUrl || 'https://via.placeholder.com/320x200?text=Package';
          document.getElementById('pkg-modal-price').textContent = `Rs. ${pkg.price || 0}`;
          document.getElementById('pkg-modal-duration').textContent = `${pkg.duration || 0} days`;
          document.getElementById('pkg-modal-status').textContent = pkg.status || 'Activated';

          // Enhanced vehicle display
          const ul = document.getElementById('pkg-modal-vehicles');
          ul.innerHTML = '';

          if (Array.isArray(pkg.vehicles) && pkg.vehicles.length){
            pkg.vehicles.forEach(v => {
              const li = document.createElement('li');
              li.style.cssText = 'margin-bottom: 12px; padding: 10px; background: rgba(212, 175, 55, 0.1); border-radius: 6px; border-left: 3px solid var(--luxury-gold);';

              const vehicleInfo = document.createElement('div');
              vehicleInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                  <div style="flex: 1;">
                    <strong style="color: var(--luxury-gold);">${v.make || 'Unknown'} ${v.model || 'Model'}</strong>
                    <div style="color: var(--text-luxury-muted); font-size: 0.9rem;">
                      Year: ${v.year || 'N/A'} |
                      Rate: Rs. ${v.rentalRatePerDay || 0}/day |
                      Status: <span style="color: ${v.status === 'AVAILABLE' ? '#27ae60' : '#e74c3c'};">${v.status || 'Unknown'}</span>
                    </div>
                  </div>
                  <button onclick="viewVehicleDetails(${v.vehicleId})"
                          style="background: var(--gradient-gold); color: var(--luxury-black); border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                    View Details
                  </button>
                </div>
              `;
              li.appendChild(vehicleInfo);
              ul.appendChild(li);
            });
          } else {
            const li = document.createElement('li');
            li.style.cssText = 'color: var(--text-luxury-muted); font-style: italic; text-align: center; padding: 20px;';
            li.textContent = 'No vehicles available in this package';
            ul.appendChild(li);
          }

          const buyBtn = document.getElementById('pkg-modal-buy');
          if (buyBtn) {
            buyBtn.onclick = () => buyPackage(pkg);
          }
          document.getElementById('package-details-modal').style.display = 'block';
        }
        window.closePackageDetailsModal = function(){ document.getElementById('package-details-modal').style.display = 'none'; };

        function buyPackage(pkg){
          // Store in localStorage for payment page handling
          localStorage.setItem('selectedPackage', JSON.stringify({
            packageId: pkg.packageId,
            packageName: pkg.packageName,
            price: pkg.price,
            duration: pkg.duration,
            imageUrl: pkg.imageUrl
          }));
          // Open package booking modal
          openPackageBookingModal(pkg);
        }

        function openPackageBookingModal(pkg) {
          // Populate package details in the booking modal
          document.getElementById("package-booking-id").value = pkg.packageId;
          document.getElementById("package-booking-name").textContent = pkg.packageName || 'Package';
          document.getElementById("package-booking-image").src = pkg.imageUrl || 'https://via.placeholder.com/100x80?text=Package';
          document.getElementById("package-booking-duration").textContent = `${pkg.duration || 0} days`;
          document.getElementById("package-booking-price").textContent = `Rs. ${pkg.price || 0}`;

          // Set minimum date to today
          const today = new Date().toISOString().split('T')[0];
          document.getElementById("package-start-date").min = today;
          document.getElementById("package-end-date").min = today;

          // Clear previous values
          document.getElementById("package-start-date").value = "";
          document.getElementById("package-end-date").value = "";
          document.getElementById("package-rental-duration").textContent = "0 days";

          // Hide any previous messages
          document.getElementById("booking-message").style.display = "none";

          // Close the package details modal and open booking modal
          closePackageDetailsModal();
          document.getElementById("package-booking-modal").style.display = "block";
        }

        window.closePackageBookingModal = function() {
          document.getElementById("package-booking-modal").style.display = "none";
        };

        // Calculate package duration when dates change
        document.getElementById("package-start-date").addEventListener("change", calculatePackageBookingDetails);
        document.getElementById("package-end-date").addEventListener("change", calculatePackageBookingDetails);

        function calculatePackageBookingDetails() {
          const startDateInput = document.getElementById("package-start-date");
          const endDateInput = document.getElementById("package-end-date");

          // Only calculate if both dates are selected
          if (!startDateInput.value || !endDateInput.value) return;

          const startDate = new Date(startDateInput.value);
          const endDate = new Date(endDateInput.value);

          // Set minimum end date based on start date
          const nextDay = new Date(startDate);
          nextDay.setDate(nextDay.getDate() + 1);
          endDateInput.min = nextDay.toISOString().split('T')[0];

          // Reset end date if it's before start date
          if (endDate <= startDate) {
            endDateInput.value = nextDay.toISOString().split('T')[0];
            endDate.setTime(nextDay.getTime());
          }

          // Calculate duration in days
          const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
          document.getElementById("package-rental-duration").textContent = `${duration} day${duration !== 1 ? 's' : ''}`;

          // Get package price from the booking modal display
          const packagePriceText = document.getElementById("package-booking-price").textContent;
          const packagePrice = parseInt(packagePriceText.replace(/\D/g, '')) || 0;

          // Update cost calculation display
          document.getElementById("package-price-display").textContent = `Rs. ${packagePrice.toFixed(2)}`;
          document.getElementById("package-days-display").textContent = `${duration} day${duration !== 1 ? 's' : ''}`;

          // Calculate and display total cost - FIXED: multiply package price by duration
          const totalCost = duration * packagePrice;
          document.getElementById("package-total-cost").textContent = `Rs. ${totalCost.toFixed(2)}`;
        }

        // Package booking form submission
        const packageBookingForm = document.getElementById("package-booking-form");
        if (packageBookingForm) {
          packageBookingForm.addEventListener("submit", function(e) {
            e.preventDefault();

            const startDate = document.getElementById("package-start-date").value;
            const endDate = document.getElementById("package-end-date").value;
            const packageId = document.getElementById("package-booking-id").value;
            const totalCost = document.getElementById("package-total-cost").textContent.replace(/[^0-9.-]+/g,"");

            if (!startDate || !endDate) {
                showBookingMessage("Please select both start and end dates.", "error");
                return;
            }

            // Build booking request (no payments)
            const bookingData = {
              startDate: startDate,
              endDate: endDate,
              packageId: packageId,
              totalCost: totalCost
            };

            // Get package details for payment page
            const packageName = document.getElementById("package-booking-name").textContent;
            const packagePriceText = document.getElementById("package-booking-price").textContent;
            const totalCostText = document.getElementById("package-total-cost").textContent;
            const duration = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24));

            // Debug logging to see what we're working with
            console.log("DEBUG - packagePriceText:", packagePriceText);
            console.log("DEBUG - totalCostText:", totalCostText);

            // Extract clean numeric values - improved logic
            const cleanPackagePrice = extractPriceFromText(packagePriceText);
            const cleanTotalCost = extractPriceFromText(totalCostText);

            console.log("DEBUG - cleanPackagePrice:", cleanPackagePrice);
            console.log("DEBUG - cleanTotalCost:", cleanTotalCost);

            // Store package booking data in localStorage for payment page
            localStorage.setItem("pendingPackageBooking", JSON.stringify(bookingData));
            localStorage.setItem("selectedPackage", JSON.stringify({
              packageId: packageId,
              packageName: packageName,
              price: cleanPackagePrice,  // Store as clean number
              duration: duration,
              totalCost: cleanTotalCost,  // Store as clean number
              startDate: startDate,
              endDate: endDate
            }));

            // Close the booking modal and redirect to payment page
            closePackageBookingModal();
            window.location.href = "/payment?mode=package";
          });
        }

        // Payment form submission
        const paymentForm = document.getElementById("payment-form");
        if (paymentForm) {
          paymentForm.addEventListener("submit", function(e) {
            e.preventDefault();

            const bookingId = document.getElementById("payment-booking-id").value;
            const paymentMethod = paymentForm.paymentMethod.value;

            // Payment processing logic here
            // For now, just simulate success
            setTimeout(() => {
              document.getElementById("payment-processing").style.display = "none";
              document.getElementById("payment-success").style.display = "block";
            }, 2000);

            // Show processing state
            document.getElementById("payment-content").style.display = "none";
            document.getElementById("payment-processing").style.display = "flex";
          });
        }

        window.closePaymentModal = function() {
          document.getElementById("payment-modal").style.display = "none";
        };

        // Make this function available globally
        window.viewVehicleDetails = function(vehicleId) {
          const vehicle = allVehicles.find(v => v.vehicleId === vehicleId);

          if (!vehicle) {
            alert('Vehicle not found');
            return;
          }

          // Populate modal with vehicle details
          document.getElementById("modal-vehicle-title").textContent = `${vehicle.make} ${vehicle.model}`;
          document.getElementById("modal-vehicle-image").src = vehicle.imageUrl || '';
          document.getElementById("modal-vehicle-make").textContent = vehicle.make || 'N/A';
          document.getElementById("modal-vehicle-model").textContent = vehicle.model || 'N/A';
          document.getElementById("modal-vehicle-year").textContent = vehicle.year || 'N/A';
          document.getElementById("modal-vehicle-registration").textContent = vehicle.registrationNumber || 'N/A';

          // Update modal to show discounted price if available
          if (vehicle.has_discount) {
            document.getElementById("modal-vehicle-rate").innerHTML = `
              <span style="text-decoration: line-through;">Rs. ${vehicle.rentalRatePerDay}/day</span>
              <span style="color: #e74c3c; font-weight: bold;">Rs. ${vehicle.discountedRatePerDay}/day</span>
            `;
          } else {
            document.getElementById("modal-vehicle-rate").textContent = `Rs. ${vehicle.rentalRatePerDay}/day`;
          }

          document.getElementById("modal-vehicle-status").textContent = vehicle.status || 'Unknown';

          // Show the modal
          document.getElementById("vehicle-details-modal").style.display = "block";
        };

        window.closeVehicleDetailsModal = function() {
          document.getElementById("vehicle-details-modal").style.display = "none";
        };

        // Current vehicle being viewed/booked
        let currentVehicle = null;

        // Booking modal functions
        window.openBookingModal = function() {
          // Get the current vehicle from the details modal
          const vehicleTitle = document.getElementById("modal-vehicle-title").textContent;
          const vehicleMake = document.getElementById("modal-vehicle-make").textContent;
          const vehicleModel = document.getElementById("modal-vehicle-model").textContent;

          // Find the vehicle in our allVehicles array
          currentVehicle = allVehicles.find(v =>
            `${v.make} ${v.model}` === vehicleTitle ||
            (v.make === vehicleMake && v.model === vehicleModel)
          );

          if (!currentVehicle) {
            alert('Vehicle not found for booking');
            return;
          }

          // Set vehicle ID in the booking form
          document.getElementById("booking-vehicle-id").value = currentVehicle.vehicleId;

          // Set minimum date to today
          const today = new Date().toISOString().split('T')[0];
          document.getElementById("booking-start-date").min = today;
          document.getElementById("booking-end-date").min = today;

          // Clear previous values
          document.getElementById("booking-start-date").value = "";
          document.getElementById("booking-end-date").value = "";
          document.getElementById("rental-duration").textContent = "0 days";
          document.getElementById("days-count-display").textContent = "0";

          // Set rental rate display
          const rentalRate = currentVehicle.has_discount ?
            currentVehicle.discountedRatePerDay :
            currentVehicle.rentalRatePerDay;
          document.getElementById("daily-rate-display").textContent = `Rs. ${rentalRate}`;
          document.getElementById("total-cost-display").textContent = `Rs. 0.00`;

          // Hide any previous messages
          document.getElementById("booking-message").style.display = "none";

          // Close the vehicle details modal and open booking modal
          closeVehicleDetailsModal();
          document.getElementById("booking-modal").style.display = "block";
        };

        window.closeBookingModal = function() {
          document.getElementById("booking-modal").style.display = "none";
        };

        // Calculate duration and total cost when dates change
        document.getElementById("booking-start-date").addEventListener("change", calculateBookingDetails);
        document.getElementById("booking-end-date").addEventListener("change", calculateBookingDetails);

        function calculateBookingDetails() {
          const startDateInput = document.getElementById("booking-start-date");
          const endDateInput = document.getElementById("booking-end-date");

          // Only calculate if both dates are selected
          if (!startDateInput.value || !endDateInput.value) return;

          const startDate = new Date(startDateInput.value);
          const endDate = new Date(endDateInput.value);

          // Set minimum end date based on start date
          const nextDay = new Date(startDate);
          nextDay.setDate(nextDay.getDate() + 1);
          endDateInput.min = nextDay.toISOString().split('T')[0];

          // Reset end date if it's before start date
          if (endDate <= startDate) {
            endDateInput.value = nextDay.toISOString().split('T')[0];
            endDate.setTime(nextDay.getTime());
          }

          // Calculate duration in days
          const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
          document.getElementById("rental-duration").textContent = `${duration} day${duration !== 1 ? 's' : ''}`;
          document.getElementById("days-count-display").textContent = duration;

          // Calculate total cost
          if (currentVehicle) {
            const dailyRate = currentVehicle.has_discount ?
              currentVehicle.discountedRatePerDay :
              currentVehicle.rentalRatePerDay;
            const totalCost = duration * dailyRate;
            document.getElementById("total-cost-display").textContent = `Rs. ${totalCost.toFixed(2)}`;
            document.getElementById("booking-total-cost").value = totalCost.toFixed(2);
          }
        }

        // Booking form submission
        const bookingForm = document.getElementById("booking-form");
        if (bookingForm) {
          bookingForm.addEventListener("submit", function(e) {
            e.preventDefault();

            const startDate = document.getElementById("booking-start-date").value;
            const endDate = document.getElementById("booking-end-date").value;
            const vehicleId = document.getElementById("booking-vehicle-id").value;
            const totalCost = document.getElementById("booking-total-cost").value;

            if (!startDate || !endDate) {
                showBookingMessage("Please select both start and end dates.", "error");
                return;
            }

            // Build booking request (no payments)
            const bookingData = {
              startDate: startDate,
              endDate: endDate,
              vehicleId: vehicleId,
              totalCost: totalCost
            };

            const token = localStorage.getItem("token");
            const headers = {
              'Content-Type': 'application/json'
            };
            if (token) headers['Authorization'] = `Bearer ${token}`;

            // Disable button while processing
            const btn = document.getElementById('confirm-booking-btn');
            btn.disabled = true;
            btn.textContent = 'Processing...';


            // Store booking data in localStorage for payment page
            localStorage.setItem("pendingBooking", JSON.stringify(bookingData));
            localStorage.setItem("selectedVehicle", JSON.stringify(currentVehicle));

            // Close the booking modal and redirect to payment page
            closeBookingModal();
            window.location.href = "/payment";

            fetch('/api/bookings', {
              method: 'POST',
              headers,
              body: JSON.stringify(bookingData)
            })
            .then(async (r) => {
              let data = null; try { data = await r.json(); } catch(_) {}
              if (!r.ok) throw new Error((data && data.message) || 'Booking failed');
              return data;
            })
            .then((data) => {
              showBookingMessage('Booking confirmed successfully.', 'success');
              // Close modal after short delay
              setTimeout(() => {
                closeBookingModal();
                // Optional: redirect or refresh
                window.location.href = '/dashboard?message=' + encodeURIComponent('Booking confirmed') + '&type=success';
              }, 1200);
            })
            .catch((err) => {
              console.error(err);
              showBookingMessage(err.message || 'Booking failed. Please try again.', 'error');
            })
            .finally(() => {
              btn.disabled = false;
              btn.textContent = 'Confirm Booking';
            });

          });
        }

        function showBookingMessage(text, type) {
          const el = document.getElementById('booking-message');
          el.textContent = text;
          el.className = 'message ' + (type || 'info');
          el.style.display = 'block';
        }

        // Add price extraction function
        function extractPriceFromText(text) {
          if (!text) return 0;

          // Remove all non-digit and non-decimal characters, but keep dots for decimals
          const cleanText = text.toString().replace(/[^\d.]/g, '');

          // Parse as float to handle decimals properly
          const parsed = parseFloat(cleanText);

          // Return 0 if parsing failed
          return isNaN(parsed) ? 0 : parsed;
        }

        // Removed: All payment-related functions (showPaymentModal, handlePaymentSubmission, card validation, etc.)

        // Notifications logic
        const notifList = document.getElementById('notif-list');
        const notifBadge = document.getElementById('notif-badge');
        const notifMarkAllBtn = document.getElementById('notif-mark-all');

        function getReadSet(){
          try { return new Set(JSON.parse(localStorage.getItem('notifReadIds')||'[]')); } catch(_) { return new Set(); }
        }
        function saveReadSet(set){ localStorage.setItem('notifReadIds', JSON.stringify(Array.from(set))); }

        function renderNotifications(notifications){
          notifList.innerHTML = '';
          const readSet = getReadSet();
          let unreadCount = 0;

          if (!Array.isArray(notifications) || notifications.length === 0){
            notifList.innerHTML = '<div class="notif-empty">No notifications yet</div>';
          } else {
            notifications.forEach(n => {
              const id = n.id || (n.type + '_' + (n.bookingId || '') + '_' + (n.timestamp || ''));
              const isRead = id && readSet.has(id) ? true : false;
              if (!isRead) unreadCount++;
              const icon = (n.icon || 'fa-bell').replace('fa-', '');
              const sev = (n.severity || 'info').toLowerCase();
              const time = n.timestamp ? new Date(n.timestamp).toLocaleString() : '';
              const item = document.createElement('div');
              item.className = 'notif-item';
              const hasBid2 = !!n.bookingId;
              const typeStr2 = (n.type || '').toString().toLowerCase();
              const titleStr2 = (n.title || '').toString().toLowerCase();
              // Show receipt for booking confirmations and payment confirmations (never for cancellations)
              const isBooking2 = (
                titleStr2.includes('booking confirmed') ||
                typeStr2.includes('booking_confirmed') ||
                typeStr2.includes('booking confirmed') ||
                typeStr2 === 'bookingconfirmed'
              );
              const isPayment2 = (
                titleStr2.includes('payment confirmed') ||
                typeStr2.includes('payment_confirmed') ||
                typeStr2.includes('payment confirmed') ||
                typeStr2 === 'paymentconfirmed'
              );
              const receiptKind2 = isBooking2 ? 'booking' : (isPayment2 ? 'payment' : null);
              const showDownload = hasBid2 && !!receiptKind2;
              if (showDownload) { try { console.debug('Notif receipt button enabled (footer block)', { bookingId: n.bookingId, kind: receiptKind2, type: n.type, title: n.title }); } catch(_){} }
              item.innerHTML = `
                <div class="notif-icon ${sev}"><i class="fas ${n.icon ? n.icon : 'fa-bell'}"></i></div>
                <div class="notif-content">
                  <div class="notif-title">${n.title || 'Notification'}</div>
                  <div style="font-size:0.9rem;color:var(--text-luxury-muted);margin-top:4px;">${n.message || ''}</div>
                  <div class="notif-time">${time}</div>
                </div>
                <div class="notif-actions">
                  ${showDownload ? `<button class="notif-download" data-kind="${receiptKind2}" data-bid="${n.bookingId}" title="Download receipt"><i class=\"fas fa-download\"></i> Receipt</button>` : ''}
                  <span class="notif-tick ${isRead ? 'read' : ''}" data-id="${id}" title="Mark as read"><i class="fas fa-check"></i></span>
                </div>`;
              notifList.appendChild(item);
            });
          }

          // Update badge
          if (unreadCount > 0){
            notifBadge.style.display = 'inline-block';
            notifBadge.textContent = unreadCount;
          } else {
            notifBadge.style.display = 'none';
          }
        }

        async function updateNotifications(){
          try {
            const token = localStorage.getItem('token');
            const headers = { 'Accept': 'application/json' };
            if (token) headers['Authorization'] = `Bearer ${token}`;
            const res = await fetch('/api/customer/notifications', { headers });
            const list = await res.json();
            renderNotifications(Array.isArray(list) ? list : []);
          } catch (e) {
            console.error('Failed to load notifications', e);
          }
        }

        // Mark all read
        if (notifMarkAllBtn){
          notifMarkAllBtn.addEventListener('click', () => {
            try {
              const ids = Array.from(notifList.querySelectorAll('.notif-tick')).map(el => el.getAttribute('data-id')).filter(Boolean);
              const set = getReadSet(); ids.forEach(id => set.add(id)); saveReadSet(set);
              updateNotifications();
            } catch(e){ console.error('Failed to mark all read', e); }
          });
        }

        // Tick one notification
        if (notifList){
          notifList.addEventListener('click', (e) => {
            const tick = e.target.closest('.notif-tick');
            if (!tick) return;
            const id = tick.getAttribute('data-id');
            if (!id) return;
            const set = getReadSet(); set.add(id); saveReadSet(set);
            updateNotifications();
          });

          // Download colourful booking receipt
          notifList.addEventListener('click', async (e) => {
            const btn = e.target.closest('.notif-download');
            if (!btn) return;
            const bid = btn.getAttribute('data-bid');
            if (!bid) return;
            try {
              const token = localStorage.getItem('token');
              const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
              const res = await fetch(`/api/receipts/booking/${bid}`, { headers });
              if (!res.ok) throw new Error('Download failed');
              const blob = await res.blob();
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url; a.download = `booking-receipt-${bid}.html`;
              document.body.appendChild(a); a.click(); a.remove();
              window.URL.revokeObjectURL(url);
            } catch(err) {
              console.error(err); alert('Could not download receipt.');
            }
          });

          // Link version of receipt download
          notifList.addEventListener('click', async (e) => {
            const link = e.target.closest('.notif-receipt-link');
            if (!link) return;
            e.preventDefault();
            const bid = link.getAttribute('data-bid');
            if (!bid) return;
            const kind = link.getAttribute('data-kind') || 'booking';
            try {
              const token = localStorage.getItem('token');
              const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
              const res = await fetch(`/api/receipts/${kind}/${bid}`, { headers });
              if (!res.ok) throw new Error('Download failed');
              const blob = await res.blob();
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              const fname = kind === 'payment' ? `payment-receipt-${bid}.html` : `booking-receipt-${bid}.html`;
              a.href = url; a.download = fname;
              document.body.appendChild(a); a.click(); a.remove();
              window.URL.revokeObjectURL(url);
            } catch(err) { console.error(err); alert('Could not download receipt.'); }
          });
        }

        // Initial load + polling
        updateNotifications();
        setInterval(updateNotifications, 30000);
      });
    </script>

    <!-- Luxury Theme Scripts -->
    <script src="/js/luxury-theme.js"></script>
    <script src="/js/luxury-theme-enhancer.js"></script>
  </body>
</html>
